voicekey.platform
программный комплекс мультимодальной
биометрической аутентификации
руководство по установке и настройке
stc-s9726
версия документа: 1-030322
нцда.00741-01 93
версия программного обеспечения: 4.6
2 руководство по установке и настройке
содержание voicekey.platform
содержание
1. общие сведения ..................................................................................................................................... 7
1.1 основные сведения о комплексе ................................................................................................................................................................ 7
1.2 назначение комплекса ......................................................................................................................................................................................... 7
1.3 служба технической поддержки ................................................................................................................................................................. 7
2. распределение компонентов и пререквизитов ............................................................... 8
3. программно-аппаратные требования ................................................................................... 9
4. общие настройки системы ......................................................................................................... 13
5. установка и настройка пререквизитов .............................................................................. 16
5.1 создание yum-репозиториев...................................................................................................................................................................... 16
5.1.1 установка и настройка apache .................................................................................................................................................. 16
5.1.2 создание репозиториев ................................................................................................................................................................. 17
5.1.3 подключение репозитория ......................................................................................................................................................... 18
5.2 установка jdk ............................................................................................................................................................................................................. 18
5.2.1 установка oracle jdk .......................................................................................................................................................................... 18
5.2.2 установка переменных среды — java_home и path .......................................................................................... 18
5.3 установка и настройка бд ............................................................................................................................................................................... 19
5.3.1 установка и настройка oracle database 18c xe ............................................................................................................ 19
5.3.2 установка и настройка postgresql ........................................................................................................................................ 22
5.4 установка и настройка mongodb ............................................................................................................................................................. 24
5.4.1 установка mongodb ........................................................................................................................................................................... 24
5.4.2 настройка mongodb .......................................................................................................................................................................... 24
5.4.3 удалённое подключение к mongodb ................................................................................................................................. 25
5.5 установка и настройка rabbitmq .............................................................................................................................................................. 25
5.6 установка драйвера hasp-ключа .............................................................................................................................................................. 26
5.7 установка libsndfile и libgomp ...................................................................................................................................................................... 26
5.8 установка libpng ...................................................................................................................................................................................................... 27
5.9 установка jsvc .......................................................................................................................................................................................................... 27
6. установка и настройка компонентов ................................................................................ 28
3 руководство по установке и настройке
содержание voicekey.platform
6.1 компоненты комплекса ..................................................................................................................................................................................... 28
6.2 настройка подключения по протоколу https .............................................................................................................................. 28
6.3 установка с помощью ansible ...................................................................................................................................................................... 33
6.4 установка сервисов и обработчиков вручную ............................................................................................................................. 34
6.5 установка веб-сервисов ................................................................................................................................................................................... 35
6.5.1 apache tomcat ......................................................................................................................................................................................... 35
6.5.2 sessionservice application ............................................................................................................................................................... 35
6.5.3 groupservice application .................................................................................................................................................................. 35
6.6 установка voicekey portal................................................................................................................................................................................. 35
6.7 установка из yum-репозитория ................................................................................................................................................................. 37
6.8 настройка через configurator component ....................................................................................................................................... 38
6.8.1 предварительная настройка ....................................................................................................................................................... 38
6.8.2 веб-интерфейс configurator component .......................................................................................................................... 39
6.8.3 глобальные настройки ..................................................................................................................................................................... 41
6.8.4 файловое хранилище ........................................................................................................................................................................ 50
6.8.5 индивидуальные настройки компонентов ..................................................................................................................... 51
6.8.6 индивидуальные настройки экземпляров ...................................................................................................................... 73
6.8.7 настройка учётных данных configurator component ............................................................................................. 74
6.9 запуск компонентов ............................................................................................................................................................................................ 74
6.10 настройка kerberosproxy component ................................................................................................................................................ 75
6.10.1 создание учётной записи в ad .............................................................................................................................................. 76
6.10.2 генерация keytab-файла ............................................................................................................................................................... 77
6.10.3 конфигурация kerberosproxy component ..................................................................................................................... 78
6.10.4 устранение неполадок ................................................................................................................................................................. 79
6.11 security component: работа с веб-интерфейсом ...................................................................................................................... 81
6.11.1 структура разграничения прав доступа ........................................................................................................................ 82
6.11.2 управление пользователями ................................................................................................................................................... 83
6.11.3 управление должностями .......................................................................................................................................................... 83
6.11.4 управление ролями ......................................................................................................................................................................... 84
6.11.5 привилегии ............................................................................................................................................................................................. 85
6.11.6 управление доменами ................................................................................................................................................................... 91
6.11.7 управления ключами ...................................................................................................................................................................... 92
4 руководство по установке и настройке
содержание voicekey.platform
6.12 security component: настройка интеграции с ldap ............................................................................................................. 92
6.12.1 создание учётной записи ad .................................................................................................................................................. 92
6.12.2 настройка подключения к ad ................................................................................................................................................. 93
6.12.3 настройка ssl ........................................................................................................................................................................................ 93
6.12.4 настройка автоматической синхронизации .............................................................................................................. 95
6.12.5 управление пользователями ................................................................................................................................................... 98
6.13 mediastorage component: работа с веб-интерфейсом ........................................................................................................ 99
6.13.1 загрузка файлов ............................................................................................................................................................................... 101
6.13.2 управление файлами ................................................................................................................................................................... 103
6.13.3 регистрация новых типов файлов ..................................................................................................................................... 106
6.14 установка и настройка audio acquisition server ..................................................................................................................... 107
6.15 reporter component: работа с веб-интерфейсом .................................................................................................................. 109
6.15.1 подготовка к запуску ................................................................................................................................................................... 110
6.15.2 управление шаблонами ............................................................................................................................................................ 111
6.15.3 настройка отчётов ......................................................................................................................................................................... 113
6.15.4 настройка расписания ............................................................................................................................................................... 115
6.16 протоколирование работы...................................................................................................................................................................... 118
6.17 monitoring component: метрики ........................................................................................................................................................ 119
6.17.1 получение данных ......................................................................................................................................................................... 129
7. управление компонентами ..................................................................................................... 132
7.1 настройка конфигурационных файлов ............................................................................................................................................ 132
7.2 настройка tomcat ............................................................................................................................................................................................... 134
8. обновление компонентов ........................................................................................................ 135
8.1 обновление rpm .................................................................................................................................................................................................. 135
8.2 обновление из yum-репозитория ....................................................................................................................................................... 135
8.3 настройка конфигурационных файлов ............................................................................................................................................ 136
8.4 обновление базы данных ............................................................................................................................................................................. 136
9. глоссарий............................................................................................................................................. 137
5 руководство по установке и настройке
voicekey.platform
введение
общие положения
данное руководство предназначено для разработчиков и администраторов, осуществляющих
установку, настройку и обновление программного комплекса мультимодальной биометрической
аутентификации voicekey.platform (далее — комплекса voicekey.platform).
сведения, приведённые в руководстве, относятся к версии 4.6 комплекса voicekey.platform.
настоящее руководство не заменяет учебную и справочную литературу от производителей
операционной системы и общего программного обеспечения.
соглашения и обозначения
в документе приняты следующие типографские соглашения:
формат текста описание
обычный основной текст документа
полужирный наименования компаний, программ и программных компонентов, а также
наименования элементов интерфейса (заголовки, кнопки и т.п.)
полужирный курсив имена файлов и пути доступа к ним
моноширинный параметры конфигурации, параметры api, тексты примеров api
подчёркнутый синий внешние ссылки и ссылки на разделы документа
элемент > вложенный
элемент
выбор пункта меню. например, текст файл > выход означает: выбрать
меню файл, а затем — команду выход из меню файл
<метка> фрагмент текста, который должен быть заменён реальным значением.
например, в записи d:\<dirname>\file.txt текст <dirname> используется
для обозначения названия каталога в файловой системе
обязательные действия, невыполнение которых может привести к ошибке.
примечания, рекомендации и прочие сведения.
ссылки на другие документы.
введение
6 руководство по установке и настройке
voicekey.platform
товарные знаки
названия компаний и названия продуктов, упомянутые в документе, являются собственностью их
соответствующих владельцев.
ни одна из частей этого издания не подлежит воспроизведению, передаче, хранению в поисковой
системе или переводу на какой-либо язык в любой форме, любыми средствами без письменного
разрешения общества с ограниченной ответственностью «црт-инновации».
введение
7 руководство по установке и настройке
общие сведения voicekey.platform
1. общие сведения
1.1 основные сведения о комплексе
наименование: программный комплекс мультимодальной биометрической
аутентификации voicekey.platform
условное наименование: stc-s9726
обозначение: нцда.00741-01
изготовитель: общество с ограниченной ответственностью «црт-инновации»
адрес: 194044, санкт-петербург, ул. гельсингфорсская, д. 3, к. 11 лит. д, пом. 229
телефон: +7 (812) 325-88-48
факс: +7 (812) 327-92-97
1.2 назначение комплекса
программный комплекс voicekey.platform (далее voicekey.platform) — программный продукт,
который служит основой для построения решений биометрической аутентификации клиентов при
удалённом обслуживании.
1.3 служба технической поддержки
адрес службы сервисного обслуживания и технической поддержки в интернете:
электронная почта: info@speechpro.com
адрес в сети интернет: http://www.speechpro.ru/support
при обращении в службу технической поддержки необходимо представить четкое описание
возникшей проблемы.
предварительно подготовьте следующую информацию:
– сведения о конфигурации серверов;
– название и версии используемых операционных систем;
– версия программного обеспечения.
8 руководство по установке и настройке
распределение компонентов и пререквизитов voicekey.platform
2. распределение компонентов и пререквизитов
для корректной работы voicekey.platform производится установка:
– компонентов — программных продуктов на базе voicekey.platform.
– пререквизитов — стороннего программного обеспечения.
компоненты и пререквизиты объединяются в функциональные блоки. типовое распределение
компонентов и пререквизитов приведено в таблице ниже.
название назначение
блоки компонентов voicekey.platform
блок сервисов установка компонентов, обеспечивающих функционирование комплекса.
блок веб-сервисов установка компонентов с rest api, направленных на реализацию какого-
либо сценария.
блок обработчиков установка компонентов, предназначенных для обработки
биометрических запросов.
сервер съёма звука установка audio acquisition server и системы записи телефонных
вызовов и речевых сообщений в качестве поставщика звука.
блоки пререквизитов (стороннего по)
медиахранилище установка mongodb.
база данных установка oracle database или postgresql.
блоки компонентов и пререквизитов распределяются по серверам с учётом нагрузки. при низкой
нагрузке все блоки, за исключением медиахранилища и сервера съёма звука, могут быть установлены на
одном сервере. при высокой нагрузке рекомендуется устанавливать каждый блок на отдельный сервер.
отдельно рекомендуется:
– при использовании нескольких обработчиков устанавливать каждый обработчик на отдельном
сервере.
– устанавливать mongodb на отдельном сервере из-за высокого потребления оперативной памяти.
– устанавливать audio acquisition server на отдельном сервере вместе с компонентами системы
записи телефонных вызовов и речевых сообщений.
– устанавливать связующее по rabbitmq на одном из серверов в составе комплекса, к которому
подключаются компоненты комплекса для получения доступа к шине данных. как правило, rabbitmq
устанавливается на сервер, на котором установлены сервисы.
9 руководство по установке и настройке
программно-аппаратные требования voicekey.platform
3. программно-аппаратные требования
в таблице ниже приведены программно-аппаратные требования для типовой схемы развёртывания
комплекса voicekey.platform.
требования приводятся с учётом распределения компонентов и пререквизитов на функциональные
блоки (см. раздел распределение компонентов и пререквизитов).
название состав аппаратные требования программные требования
блоки компонентов voicekey.platform
блок сервисов cache component
chronicler component
configurator component
kerberosproxy component
licensing component
loadbalancer component
mediahub component
monitoring component
mrcp application
reporter component
ripper component
router component
security component
mediastorage component
database component
siphon application
рассчитываются
индивидуально*
1. centos (7.5 и выше) /
redhat linux (rhel 7.5 и
выше) x64;
2. rabbitmq 3.6.11 (или
выше);
3. java se development kit
8 x64;
4. jsvc;
5. драйвер hasp-ключа
для licensing
component.
блок веб-сервисов groupservice application
sessionservice application
agent application
antispoofing application
asr application
diarization application
ebsadapter application
inspectorrest application
smevadapter application
mediagallery application
fraud application
onepass application
tracker application
tts application
vocabulary application
buzzer application
рассчитываются
индивидуально*
при использовании
liveness detection в
voicekey.onepass ram
рассчитывается с учётом
необходимого количества
транзакций**
1. centos (7.5 и выше) /
redhat linux (rhel 7.5 и
выше) x64;
2. rabbitmq 3.6.11 (или
выше);
3. java se development kit
8 x64;
4. jsvc;
5. apache tomcat 7.
10 руководство по установке и настройке
программно-аппаратные требования voicekey.platform
название состав аппаратные требования программные требования
блок обработчиков voicegrid processor рассчитываются
индивидуально*
1. centos (7.5 и выше) /
redhat linux (rhel 7.5 и
выше) x64;
2. java se development kit
8 (x64);
3. libsndfile;
4. libgomp;
5. jsvc;
6. драйвер hasp-ключа .
voicekey processor рассчитываются
индивидуально*
1. centos (7.5 и
выше)/redhat linux
(rhel 7.5 и выше) x64;
2. java se development kit
8 (x64);
3. libsndfile;
4. libgomp;
5. jsvc;
6. драйвер hasp-ключа.
facestc processor процессор должен
поддерживать инструкции
avx2.
остальные требования
рассчитываются
индивидуально*
1. centos (7.5 и выше) /
redhat linux (rhel 7.5 и
выше) x64;
2. java se development kit
8 (x64);
3. libpng;
4. jsvc;
5. драйвер hasp-ключа.
asr processor,
vad processor
voicerecognizer processor
texttransform processor
рассчитываются
индивидуально*
1. centos (7.5 и выше) /
redhat linux (rhel 7.5 и
выше) x64;
2. java se development kit
8 (x64);
3. драйвер hasp-ключа.
tts processor процессор должен
поддерживать инструкции
avx2.
остальные требования
рассчитываются
индивидуально*
1. centos (7.5 и выше) /
redhat linux (rhel 7.5 и
выше) x64;
2. java se development kit
8 (x64);
3. драйвер hasp-ключа.
11 руководство по установке и настройке
программно-аппаратные требования voicekey.platform
название состав аппаратные требования программные требования
сервер съёма звука audio acquisition server рассчитываются
индивидуально*
1. windows server 2012
x64;
2. net framework 4.5.
блоки пререквизитов (стороннего по)
база данных — рассчитываются
индивидуально*
1. centos (7.5 и выше) /
redhat linux (rhel 7.5 и
выше) x64/windows
server 2012 x64;
2. java se development kit
8 (x64);
3. oracle database 12с и
выше/ postgresql 9.6.
медиахранилище — рассчитываются
индивидуально*
1. centos (7.5 и выше) /
redhat linux (rhel 7.5 и
выше) x64 / windows
server 2012 x64;
2. java se development kit
8 (x64);
3. mongodb 4.2.0.
*аппаратные требования рассчитываются индивидуально в зависимости от назначения системы заказчика, на этапе
формирования проектной документации данной системы.
**при использовании сценария voicekey.onepass с детектором живого пользователя (liveness) необходимо индивидуально
произвести расчёт оперативной памяти для виртуальной машины java в зависимости от требуемого количества
одновременных транзакций. например, для видеофайла размером не более 1 мбайт необходимо выделять память из расчёта
50 мбайт на транзакцию.
для корректной работы комплекса voicekey.platform рекомендуется использовать процессоры с
поддержкой инструкций avx2.
в графе таблицы программные требования приведён список программных компонентов, которые
должны быть установлены перед началом установки компонентов комплекса voicekey.platform или
стороннего по для блоков пререквизитов.
для защиты обработчиков (voicegrid processor, voicekey processor, facestc processor, asr
processor, vad processor, voicerecognizer processor, texttransform processor, tts processor), веб-
сервисов (agent application, asr application, fraud application, inspectorrest application, onepass
application, tracker application, tts application, vocabulary application, buzzer application) и сервиса
mrcp application от несанкционированного использования применяются электронные ключи защиты
hasp (аппаратные или программные). в отсутствие ключей защиты работа этих компонентов невозможна.
перечисленные веб-сервисы и mrcp application получают информацию о hasp-ключах от licensing
component. обработчик проверяет наличие hasp-ключа на локальном хосте.
12 руководство по установке и настройке
программно-аппаратные требования voicekey.platform
установка по системы записи телефонных вызовов выполняется в соответствии с инструкциями,
приведёнными в соответствующей документации.
13 руководство по установке и настройке
общие настройки системы voicekey.platform
4. общие настройки системы
на всех серверах комплекса рекомендуется использовать статические ip-адреса.
для настройки статической адресации отредактируйте файл сетевого интерфейса. настройки dns-
серверов отдельно укажите в файле /etc/resolv.conf.
убедитесь, что дата и время совпадают на всех серверах комплекса.
если при выполнении команды hostname -f некорректно отображается имя сервера, укажите его в
файле /etc/hostname.
для корректной работы компонентов комплекса отключите систему контроля доступа selinux.
чтобы применить настройки, перезагрузите компьютер.
отключите брандмауэр. если отключения брандмауэра невозможно, то настройте его таким образом,
чтобы подключения по портам, приведенным в таблице ниже, были разрешены.
сервер номер порта назначение
сервер, на котором
установлено по rabbitmq
5672 подключение компонентов комплекса к шине данных
rabbitmq
15672 доступ к веб-интерфейсу управления и мониторинга
шины данных rabbitmq
сервер субд postgresql 5432 доступ к субд postgresql
сервер субд oracle database 1521 доступ к субд oracle database
сервер, на котором
установлено по mongodb
27017 подключение компонентов комплекса к mongodb
серверы, на которых
установлены voicegrid
processor, voicekey
processor, asr processor, tts
processor, facestc processor
1947 доступ к веб-интерфейсу управления и мониторинга
состояния hasp-ключей
сервер, на котором
установлен configurator
component
5566 подключение компонентов комплекса к компоненту
конфигурации
8082 доступ к веб-интерфейсу компонента конфигурации
5004 порт отладки
44303 доступ к веб-интерфейсу компонента конфигурации по
протоколу https
44304 доступ к веб-интерфейсу компонента конфигурации по
протоколу https с двусторонней аутентификацией по
ssl-сертификату
сервер дополнительных веб-
приложений
80 доступ к apache http server
14 руководство по установке и настройке
общие настройки системы voicekey.platform
сервер номер порта назначение
(voicekey.onepass,
voicekey.agent и др.)
443 доступ к apache http server по защищенному
протоколу ssl
8080 доступ к apache tomcat
сервер licensing component 8081 доступ к веб-интерфейсу менеджера лицензий
45678 доступ к компоненту для получения информации о
лицензиях
45679 доступ к компоненту для получения информации о
лицензиях с использованием шифрования
5011 порт отладки
1947 доступ к веб-интерфейсу управления и мониторинга
состояния hasp-ключей
сервер компонента
mediastorage component
8083 доступ к веб-интерфейсу компонента
5013 порт отладки
сервер reporter component 8085 доступ к веб-интерфейсу компонента формирования
отчётности
44301 доступ к веб-интерфейсу компонента по протоколу
https
44302 доступ к веб-интерфейсу компонента по протоколу
https с двусторонней аутентификацией по ssl-
сертификату
5016 порт отладки
сервер asr processor 6006 порт отладки
9091 порт для подключения по протоколу websocket
сервер tts processor 6005 порт отладки
9090 порт для подключения по протоколу websocket
сервер security component 8086 доступ к веб-интерфейсу подсистемы разграничения
доступа
5008 порт отладки
44305 доступ к веб-интерфейсу компонента по протоколу
https
44306 доступ к веб-интерфейсу подсистемы разграничения
доступа по протоколу https с двусторонней
аутентификацией по ssl-сертификату
сервер database component 5006 порт отладки
15 руководство по установке и настройке
общие настройки системы voicekey.platform
сервер номер порта назначение
сервер cache component 5005 порт отладки
сервер chronicler
component
5012 порт отладки
сервер monitoring
component
5009 порт отладки
сервер loadbalancer
component
5014 порт отладки
16 руководство по установке и настройке
установка и настройка пререквизитов voicekey.platform
5. установка и настройка пререквизитов
в настоящем разделе приведена информация об установке стороннего программного обеспечения,
необходимого для работы комплекса voicekey.platform.
установочные файлы некоторых общих компонентов входят в состав дистрибутива комплекса
voicekey.platform.
если они отсутствуют, установку следует выполнять из репозитория epel (extra packages for enterprise
linux) или загружать установочные файлы с официальных сайтов разработчиков.
все действия следует выполнять от имени пользователя root. при установке
непривилегированным пользователем команды выполняются через повышение прав sudo.
5.1 создание yum-репозиториев
для централизованного хранения рекомендуется создать центральный репозиторий, содержащий
rpm-пакеты и rpm-пакеты зависимостей.
используйте любой веб-сервер принятый за стандарт в вашей организации. далее, в качестве
примера, приведена установка и настройка веб-сервера apache.
5.1.1 установка и настройка apache
установка apache
установите apache с помощью yum:
yum -y install httpd
настройка httpd-сервера
отредактируйте файл httpd.conf:
vi /etc/httpd/conf/httpd.conf
настройте сервер на порт 8084, изменив listen 80 на listen 8084.
измените serveradmin root@localhost на ваш почтовый адрес, например,
serveradmin voiсekey@speechpro.com.
укажите fdqn сервера, заменив servername www.example.com:80 на
servername www.<host>:8084, где <host> — имя вашего сервера.
измените allowoverride none на allowoverride all.
настройка firewall
1. для просмотра активной зоны выполните команду:
firewall-cmd --get-active-zones
2. разрешите порт 8084 для сервера и все порты, перечисленные в таблице из раздела общие
настройки системы. в параметр zone укажите активную зону из предыдущей команды.
firewall-cmd --zone=public --add-port=8084/tcp --permanent
3. запустите сервер и добавьте его в автозапуск:
systemctl start httpd
systemctl enable httpd
17 руководство по установке и настройке
установка и настройка пререквизитов voicekey.platform
5.1.2 создание репозиториев
распакуйте архивные файлы дистрибутива в каталог /var/www/html/. структура каталогов должна
иметь следующий вид:
tree /var/www/html/
/var/www/html/
├── vkappear/
│ ├── vkagent-<version>.ear
│ ├── vkasr-<version>.ear
│ ├── vkemo-<version>.ear
│ ├── vkgroup-<version>.ear
│ ├── vkonepass-<version>.ear
│ ├── vksession-<version>.ear
│ └── vktts-<version>.ear
├── vkapphttp/
│ └── webportal-<version>.tar.gz
├── vkappwar/
│ ├── ebsliveness-<version>.war
│ ├── ebsprocessor-<version>.war
│ ├── vkagent-<version>.war
│ ├── vkantispoofing-<version>.war
│ ├── vkasr-<version>.war
│ ├── vkbuzzer-<version>.war
│ ├── vkdiarization-<version>.war
│ ├── vkebsadapter-<version>.war
│ ├── vkemo-<version>.war
│ ├── vkfraud-<version>.war
│ ├── vkgroup-<version>.war
│ ├── vkinspectorrest-<version>.war
│ ├── vkmediagallery-<version>.war
│ ├── vkonepass-<version>.war
│ ├── vksession-<version>.war
│ ├── vksmevadapter-<version>.war
│ ├── vktracker-<version>.war
│ ├── vktts-<version>.war
│ └── vkvocabulary-<version>.war
├── vkplatformpackage/x86_64/el7/
│ ├── vk_asrprocessor-<version>.rpm
│ ├── vk_asrconstructorcliutil-<version>.rpm
│ ├── vk_bkkrtcprocessor-<version>.rpm
│ ├── vk_cachecomponent-<version>.rpm
│ ├── vk_chroniclercomponent-<version>.rpm
│ ├── vk_configuratorcomponent-<version>.rpm
│ ├── vk_databasecomponent-<version>.rpm
│ ├── vk_emoprocessor-<version>.rpm
│ ├── vk_facestcprocessor-<version>.rpm
│ ├── vk_facestcsdkprofiles-<version>.rpm
│ ├── vk_importertool-<version>.rpm
│ ├── vk_kerberosproxy-<version>.rpm
│ ├── vk_licensingcomponent-<version>.rpm
│ ├── vk_loadbalancercomponent-<version>.rpm
│ ├── vk_mediahubcomponent-<version>.rpm
│ ├── vk_mediastoragecomponent-<version>.rpm
│ ├── vk_monitoringcomponent-<version>.rpm
│ ├── vk_mrcpapplication-<version>.rpm
│ ├── vk_reportercomponent-<version>.rpm
│ ├── vk_rippercomponent-<version>.rpm
│ ├── vk_routercomponent-<version>.rpm
│ ├── vk_securitycomponent-<version>.rpm
│ ├── vk_siphonapplication-<version>.rpm
│ ├── vk_ttsstcprocessor-<version>.rpm
│ ├── vk_texttransformprocessor-<version>.rpm
│ ├── vk_vadprocessor-<version>.rpm
│ ├── vk_voicegridprocessor-<version>.rpm
│ ├── vk_voicegridsdkprofiles-<version>.rpm
│ ├── vk_voicekeyprocessor-<version>.rpm
│ └── vk_voicerecognizerprocessor-<version>.rpm
├── vkscripts/
18 руководство по установке и настройке
установка и настройка пререквизитов voicekey.platform
│ └── databasescripts-<version>-nix.tar.gz
5 directories
установите и запустите утилиту создания репозиториев createrepo:
yum install createrepo
createrepo /var/www/html/vkplatform
createrepo /var/www/html/vkprereq
в случае обновления содержимого директории и добавления новых версий пакетов требуется
повторно запустить данную команду для изменённого каталога.
проверьте ссылки (например, http://<host>:8084/vkplatform/, http://<host>:8084/vkprereq/), где
<host> — имя вашего сервера.
особое внимание стоит обратить на наличие папки repodata для папок подключаемых как yum-
репозиторий.
5.1.3 подключение репозитория
для подключения к репозиторию создайте соответствующие репофайлы в /etc/yum.repos.d/.
например, для репозитория vkplatform в /etc/yum.repos.d/ создайте файл vk-platform.repo со
следующим содержимым:
[vk-platform]
name=vk-platform
baseurl=http://%host%:8084/vkplatform/
enabled=1
gpgcheck=0
proxy=_none_
для репозитория с пререквизитами vkprereq создайте файл vk-prereq.repo.
[vk-prereq]
name=vk-prereq
baseurl=http://%host%:8084/vkprereq/
enabled=1
gpgcheck=0
proxy=_none_
для применения изменений выполните команду:
yum clean all
5.2 установка jdk
5.2.1 установка oracle jdk
установите пакет oracle jdk:
rpm -uvh jdk-8u191-linux-x64.rpm
update-alternatives --install /usr/bin/java java /usr/java/jdk1.8.0_191/bin/java 200000
update-alternatives --install /usr/bin/javac javac /usr/java/jdk1.8.0_191/bin/javac 200000
update-alternatives --install /usr/bin/jar jar /usr/java/jdk1.8.0_191/bin/jar 200000
update-alternatives --install /usr/bin/javaws javaws /usr/java/jdk1.8.0_191/bin/javaws 200000
update-alternatives --config java
убедитесь, что путь для установленного oracle jdk указан правильно.
при необходимости вместо пакета oracle jdk установите open jdk.
5.2.2 установка переменных среды — java_home и path
в /etc/profile.d/ создайте файл java.sh:
19 руководство по установке и настройке
установка и настройка пререквизитов voicekey.platform
vi /etc/profile.d/java.sh
файл java.sh должен содержать:
if [[ -x "/usr/java/latest/bin/java" ]]
then
export java_home=/usr/java/latest
export path=$path:/usr/java/latest/bin
else
if [[ -x "/usr/lib/jvm/jre-openjdk/bin/java" ]]
then
export java_home=/usr/lib/jvm/jre-openjdk
fi
fi
выполните команды из файла java.sh и установите java_home и path.
source /etc/profile.d/java.sh
проверьте, что java_home установлена правильно (после выполнения следующей команды должен
появиться путь к jdk):
echo $java_home
5.3 установка и настройка бд
по комплекса voicekey.platform поддерживает работу с oracle database и postgresql. в
зависимости от используемой бд распакуйте из архива нужный набор скриптов.
5.3.1 установка и настройка oracle database 18c xe
при необходимости вместо oracle database можно использовать postgresql (см. установка и
настройка postgresql).
5.3.1.1 установка oracle database 18c xe
1. скачайте предустановочный пакет:
curl -o oracle-database-preinstall-18c-1.0-1.el7.x86_64.rpm
https://yum.oracle.com/repo/oraclelinux/ol7/latest/x86_64/getpackage/oracle-database-preinstall-
18c-1.0-1.el7.x86_64.rpm
2. установите предустановочный пакет:
yum -y localinstall oracle-database-preinstall-18c-1.0-1.el7.x86_64.rpm
3. скачайте дистрибутив oracle database 18c xe с официального сайта.
4. установите экземпляр oracle database 18c xe:
yum -y localinstall oracle-database-xe-18c-1.0-1.x86_64.rpm
5. добавьте необходимые переменные окружения в .bash_profile пользователя oracle:
export oracle_sid=xe
export oraenv_ask=no
. /opt/oracle/product/18c/dbhomexe/bin/oraenv
создание и конфигурирование базы данных
1. запустите конфигуратор oracle database:
/etc/init.d/oracle-xe-18c configure
2. укажите и подтвердите произвольный пароль для учётных записей, работающих с субд (в данном
документе пароль для пользователя sys — oracle2011).
20 руководство по установке и настройке
установка и настройка пререквизитов voicekey.platform
specify a password to be used for database accounts. note that the same
password will be used for sys and system. oracle recommends the use of
different passwords for each database account. this can be done after
initial configuration:
confirm the password:
3. дождитесь завершения работы конфигуратора:
database creation complete. for details check the logfiles at: /opt/oracle/cfgtoollogs/dbca/xe.
database information:
global database name:xe
system identifier(sid):xe
look at the log file "/opt/oracle/cfgtoollogs/dbca/xe/xe.log" for further details.
connect to oracle database using one of the connect strings:
pluggable database: vknode3...:1522/xepdb1
multitenant container database: vknode3...:1522
use https://localhost:5500/em to access oracle enterprise manager for oracle database xe
5.3.1.2 настройка oracle database 18c xe
для работы с oracle database следует использовать учетную запись oracle.
выполните вход на сервер от имени пользователя oracle или используйте команду:
su — oracle
для создания табличного пространства и создания пользователей потребуется запускать командный
интерпретатор sqlplus от имени разных пользователей. например, для запуска sqlplus от имени
пользователя system, использующего пароль oracle2011, выполните следующую команду:
sqlplus system/oracle2011
для создания табличного пространства и создания пользователей выполните следующие действия:
1. запустите sqlplus от имени пользователя system и выполните sql-скрипты, начинающиеся на 0
(000, 010 и т.п.).
2. запустите sqlplus от имени пользователя clientgeneral и выполните sql-скрипты с
нумерацией от 100 до 499.
3. запустите sqlplus от имени пользователя reporter_user и выполните sql-скрипты с
нумерацией от 500 до 899.
пример наименования скриптов:
– 000-oracle-createdatafileuser.sql
– 010-oracle-create-reporter-user-tablespace.sql
– 100-oracle-createdatabase.sql
– 500-oracle-create-reporter-tables.sql
в скриптах 000-oracle-createdatafileuser.sql и 010-oracle-create-reporter-user-
tablespace.sql необходимо заменить следующие переменные:
default_datafile_path заменить на путь к файлу данных с табличным пространством;
default_vk_password заменить на пароль пользователя clientgeneral;
default_vk_reporter_password на пароль пользователя reporter_user.
по умолчанию для всех создаваемых пользователей oracle database включён режим истечения
срока действия паролей. при таком режиме пользователь, от имени которого работает
voicekey.platform с бд, может оказаться заблокированным через полгода, что приведёт к
неработоспособности voicekey.platform.
21 руководство по установке и настройке
установка и настройка пререквизитов voicekey.platform
для предотвращения этой проблемы отмените ограничение срока действия пароля в профиле,
используемом по умолчанию. запустите sqlplus под пользователем system и выполните sql-скрипт:
alter profile default limit failed_login_attempts unlimited password_life_time unlimited;
commit;
для просмотра информации обо всех пользователях используйте следующую команду:
select username,account_status,expiry_date from dba_users;
для работы voicekey.platform необходимо, чтобы для oracle database параметр processes был
больше или равен 300:
$ sqlplus / as sysdba
sql> show parameter processes
name type value
------------------------------------ ----------- ------------------------------
aq_tm_processes integer 0
db_writer_processes integer 1
gcs_server_processes integer 0
job_queue_processes integer 4
log_archive_max_processes integer 2
processes integer 100
sql> alter system set processes=300 scope=spfile;
sql> shutdown immediate
sql> startup
sql> show parameter processes
name type value
------------------------------------ ----------- ------------------------------
aq_tm_processes integer 0
db_writer_processes integer 1
gcs_server_processes integer 0
job_queue_processes integer 4
log_archive_max_processes integer 2
processes integer 300
для работы voicekey.platform необходимо, чтобы параметр sessions был больше или равен 300:
$ sqlplus / as sysdba
sql> show parameter sessions
name type value
------------------------------------ ----------- ------------------------------
java_max_sessionspace_size integer 0
java_soft_sessionspace_limit integer 0
license_max_sessions integer 0
license_sessions_warning integer 0
sessions integer 170
shared_server_sessions integer
sql> alter system set sessions=300 scope=spfile;
sql> shutdown immediate
sql> startup
sql> show parameter sessions
name type value
------------------------------------ ----------- ------------------------------
java_max_sessionspace_size integer 0
java_soft_sessionspace_limit integer 0
license_max_sessions integer 0
license_sessions_warning integer 0
sessions integer 300
shared_server_sessions integer
22 руководство по установке и настройке
установка и настройка пререквизитов voicekey.platform
5.3.2 установка и настройка postgresql
при необходимости вместо oracle database можно использовать postgresql. в данном разделе
приведена инструкция по установке и настройке postgresql версии 9.6. установка и настройка
postgresql более поздней версии осуществляется аналогичным образом.
установочные файлы для разных версий postgresql для каждой поддерживаемой ос можно
получить по ссылке: https://www.postgresql.org/download/linux/redhat/
5.3.2.1 установка репозитория
для установки репозитория с помощью yum выполните команду:
yum install -y https://download.postgresql.org/pub/repos/yum/reporpms/el-7-x86_64/pgdg-redhatrepo-
latest.noarch.rpm
более актуальную версию pgdg-redhat можно посмотреть по адресу
https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-7-x86_64.
5.3.2.2 установка postgresql
для установки базового postgresql 9.6 server выполните следующую команду:
yum install postgresql96-server
установка остальных пакетов выполняется при необходимости сходным образом.
пример:
yum install postgresql96-contrib
5.3.2.3 инициализация бд
после установки необходимо инициализировать базу данных.
для версии 9.6 инициализация выполняется командой:
/usr/pgsql-9.6/bin/postgresql96-setup initdb
5.3.2.4 запуск postgresql
для автоматического запуска postgresql при старте системы воспользуйтесь командой:
systemctl enable postgresql-9.6.service
для управления сервисом выполните команду:
service <command> postgresql-9.6.service
где <command> может приминать следующие значения:
– start : запуск экземпляра
– stop : остановка экземпляра
– reload : перечитать конфигурационные параметры при запущенном экземпляре
для запуска postgresql выполните команду:
systemctl start postgresql-9.6.service
5.3.2.5 конфигурирование
аутентификация клиентов управляется конфигурационным файлом pg_hba.conf (host-based
authentication), который расположен в каталоге с данными кластера базы
23 руководство по установке и настройке
установка и настройка пререквизитов voicekey.platform
данных /var/lib/pgsql/9.6/data/pg_hba.conf. каждая запись обозначает тип соединения, имя базы данных,
имя пользователя, диапазон ip-адресов клиента и способ аутентификации, который будет использован
для соединения в соответствии с этими параметрами.
в конфигурационный файл необходимо добавить адреса серверов, с которых будет происходить
подключение к бд, например:
# type database user address method
# "local" is for unix domain socket connections only
local all all md5
# ipv4 local connections:
host all all 127.0.0.1/32 md5
host all all 192.168.0.0/16 md5
для установки параметров экземпляра postgresql необходимо определить их значения в файле
postgresql.conf, который обычно находится в каталоге данных /var/lib/pgsql/9.6/data. измените
следующие параметры:
listen_addresses = '*' # what ip address(es) to listen on;
# comma-separated list of addresses;
# defaults to 'localhost'; use '*' for all
# (change requires restart)
port = 5432 # (change requires restart)
max_connections = 300 # (change requires restart)
...
shared_buffers = 512mb # min 128kb
# (change requires restart)
...
work_mem = 4mb # min 64kb
maintenance_work_mem = 64mb # min 1mb
для применения внесенных изменений необходимо перезагрузить postgresql:
systemctl restart postgresql-9.6.service
проверить текущие параметры можно с помощью системного представления pg_file_settings.
5.3.2.6 создание пользователей
выполните вход от имени пользователя postgres:
su - postgres
cоздайте пользователей clientgeneral и reporter_user:
createuser -p clientgeneral
createuser -p reporter_user
при выполнении команды будет предложено ввести пароль для каждого пользователя:
$ createuser -p clientgeneral
enter password for new role:***
enter it again:***
5.3.2.7 создание бд и схем
от имени пользователя postgres выполните команду создания базы данных. скрипт может быть
выполнен другим пользователем, обладающим правами на создание бд.
например, скрипт для создания базы данных с именем vkplatform и владельцем clientgeneral
будет иметь следующий вид:
createdb -o clientgeneral vkplatform
создайте схемы для каждого пользователя. для этого подключитесь к вновь созданной бд
vkplatform и выполните следующие команды:
psql -d vkplatform
24 руководство по установке и настройке
установка и настройка пререквизитов voicekey.platform
vkplatform=# create schema authorization clientgeneral;
vkplatform=# create schema authorization reporter_user;
выполните скрипты по созданию объектов бд в каждой схеме:
1. от имени пользователя clientgeneral выполните sql-скрипты с нумерацией от 100 до 499:
psql -d vkplatform -u clientgeneral -a -f /path/to/scripts/100-postgres-clientgeneral-createtables.
sql
2. от имени пользователя reporter_user выполните sql-скрипты с нумерацией от 500 до 899:
psql -d vkplatform -u reporter_user -a -f /path/to/scripts/500-postgres-create-reporter-tables.sql
5.4 установка и настройка mongodb
5.4.1 установка mongodb
для установки mongodb и зависимостей выполните:
yum install mongodb-org
установите python-pip:
yum install python-setuptools
для redhat установите python27-python-pip:
subscription-manager repos --enable rhel-server-rhscl-7-rpms
yum install python27-python-pip
проверьте pip:
which pip
pip -v
установите pymongo:
pip install pymongo-3.10.1-cp27-cp27mu-manylinux1_x86_64.whl
5.4.2 настройка mongodb
запустите mongod командой:
systemctl start mongod
подключитесь к mongo командой:
mongo --port 27017
создайте администратора пользователей:
use admin
db.createuser(
{
user: "mongoadmin",
pwd: "mongoadminpass",
roles: [ { role: "root", db: "admin" } ]
}
)
остановите mongod:
systemctl stop mongod
отредактируйте конфигурационный файл /etc/mongod.conf:
security:
authorization: enabled
25 руководство по установке и настройке
установка и настройка пререквизитов voicekey.platform
запустите mongod:
systemctl start mongod
подключитесь и авторизуйтесь как администратор:
mongo --port 27017 -u "mongoadmin" -p "mongoadminpass" --authenticationdatabase "admin"
создайте пользователя базы данных:
use voicekey
db.createuser(
{
user: "clientgeneral",
pwd: "mongo",
roles: [ { role: "readwrite", db: "voicekey" } ]
}
)
5.4.3 удалённое подключение к mongodb
по умолчанию подключение к mongodb разрешено только при обращении на localhost. чтобы
разрешить удалённые подключения, необходимо перечислить прослушиваемые адреса через запятую в
параметре net.bindip в конфигурационном файле /etc/mongod.conf:
net
bindip: 127.0.0.1,192.168.4.235
чтобы разрешить подключения ко всем ipv4 адресам, в параметре net.bindip нужно ввести
0.0.0.0
чтобы разрешить подключения ко всем ipv4 и ipv6 адресам, в параметре net.bindip нужно ввести
::,0.0.0.0
начиная с версии 3.6 mongodb для разрешения подключения ко всем адресам можно использовать
параметр net.bindipall.
параметры net.bindip и net.bindipall являются взаимоисключающими. в конфигурационном файле
допускается использование только одного из них.
5.5 установка и настройка rabbitmq
установите rabbitmq:
rpm -uvh rabbitmq-server-3.8.9-1.el7.noarch.rpm
или:
yum -y install rabbitmq-server
запустите rabbitmq:
systemctl start rabbitmq-server
удалите пользователя guest:
rabbitmqctl delete_user guest
создайте пользователя clientgeneral c правами администратора:
rabbitmqctl add_user clientgeneral rbbt
rabbitmqctl set_user_tags clientgeneral administrator
создайте виртуальный хост и предоставьте пользователю clientgeneral права на него:
26 руководство по установке и настройке
установка и настройка пререквизитов voicekey.platform
rabbitmqctl add_vhost biometryapi
rabbitmqctl set_permissions -p biometryapi clientgeneral ".*" ".*" ".*"
при необходимости включите плагин, предоставляющий веб-интерфейс для управления и контроля
за работой rabbitmq:
rabbitmq-plugins list
rabbitmq-plugins enable rabbitmq_management
перезапустите rabbitmq:
systemctl restart rabbitmq-server
при необходимости использования подключения сервера rabbitmq по протоколу ssl/tls настройте
сервер и клиент (дополнительную информацию можно получить по ссылке:
https://www.rabbitmq.com/ssl.html).
5.6 установка драйвера hasp-ключа
установочный пакет драйвера hasp-ключа входит в состав дистрибутива. для установки hasp-ключа
выполните следующую команду:
yum install aksusbd
или:
rpm -uvh aksusbd-8.11-1.x86_64.rpm
установите stc-hasp-util командой:
yum install stc-hasp-util
или:
rpm -uvh stc-hasp-util-8.11-1.rpm
остановите службу aksusbd:
systemctl stop aksusbd
скопируйте файл haspvlib_x86_64_71511.so из /opt/stc-hasp-util/ в /var/hasplm/.
чтобы контролировать состояние hasp-ключей через веб-интерфейс sentinel admin control center,
создайте в директории /etc/hasplm/ файл hasplm.ini следующего содержания:
[server]
accremote = 1
перезапустите службу aksusbd:
systemctl start aksusbd
для получения сведений об установке и активации hasp-ключа обратитесь к документу «руководство по
установке и настройке ключей защиты hasp». если данный документ отсутствует в составе дистрибутива,
обратитесь в техническую поддержку ооо «црт-инновации».
5.7 установка libsndfile и libgomp
для установки libsndfile и libgomp выполните команду:
yum -y install libsndfile libgomp
27 руководство по установке и настройке
установка и настройка пререквизитов voicekey.platform
5.8 установка libpng
для установки libpng выполните команду:
yum -y install libpng
5.9 установка jsvc
для установки jsvc выполните команду:
yum install apache-commons-daemon apache-commons-daemon-jsvc
создайте ссылку на установленный jar-файл:
ln -s /usr/share/java/apache-commons-daemon.jar /usr/share/java/jakarta-commons-daemon.jar
28 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
6. установка и настройка компонентов
6.1 компоненты комплекса
компоненты комплекса, которые могут входить в состав дистрибутива в зависимости от необходимых
сценариев использования:
– cache component-<version>
– configurator component-<version>
– chronicler component-<version>
– database component-<version>
– kerberosproxy component-<version>
– licensing component-<version>
– loadbalancer component-<version>
– mediahub component-<version>
– mediastorage component-<version>
– monitoring component-<version>
– reporter component-<version>
– ripper component-<version>
– router component-<version>
– security component-<version>
– facestc processor-<version>
– asr processor-<version>
– voicerecognizer processor-<version>
– texttransform processor-<version>
– vad processor-<version>
– tts processor-<version>
– voicegrid processor-<version>
– voicekey processor-<version>
– bkkrtc processor-<version>
– sessionservice application-<version>
– groupservice application-<version>
– mediagallery application-<version>
– mrcp application-<version>
– siphon application-<version>
установка большинства компонентов комплекса выполняется сходным образом.
6.2 настройка подключения по протоколу https
в данном пункте приводится пример установки ssl на haproxy.
1. если у вас нет ssl-сертификата, создайте самоподписанный сертификат:
– сгенерируйте ключ с помощью команды (в процессе необходимо будет ввести пароль):
openssl genrsa -des3 -out ca.<fqdn>.key 4096
29 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
– расшифруйте ключ с помощью команды (в процессе необходимо будет ввести пароль,
указанный ранее):
openssl rsa -in ca.<fqdn>.key -out ca.<fqdn>.key
– создайте файл сертификата с помощью команды ниже. в процессе создания необходимо
будет указать контактную информацию; при вводе common name необходимо ввести fqdn
сервера (чтобы узнать fqdn сервера, воспользуйтесь командой hostname --fqdn).
openssl req -new -key ca.<fqdn>.key -out ca.<fqdn>.csr
– перейдите к процессу самоподписания сертификата:
openssl x509 -req -days 365 -in ca.<fqdn>.csr -signkey ca.<fqdn>.key -out ca.<fqdn>.crt
2. скопируйте все ключи и сертификаты с помощью команды:
cp ca.<fqdn>.crt /etc/ssl/certs/
mkdir /etc/ssl/private/
cp ca.<fqdn>.key /etc/ssl/private/
mkdir /etc/ssl/csr/
cp ca.<fqdn>.csr /etc/ssl/csr/
3. объедините ключи для использования в haproxy:
cat /etc/ssl/certs/ca.<fqdn>.crt /etc/ssl/private/ca.<fqdn>.key
> /etc/ssl/private/haproxy.<fqdn>.pem
4. установите haproxy (ознакомиться с документацией можно по ссылке: https://www.haproxy.org/.
5. отредактируйте основной конфигурационный файл /etc/haproxy/haproxy.cfg, изменив
содержимое на следующее:
global
log /dev/log local2 debug
chroot /var/lib/haproxy
pidfile /var/run/haproxy.pid
maxconn 4000
user haproxy
group haproxy
daemon
# required to use ssl
tune.ssl.default-dh-param 2048
# turn on stats unix socket
stats socket /var/lib/haproxy/stats
#---------------------------------------------------------------------
# common defaults that all the 'listen' and 'backend' sections will
# use if not designated in their block
#---------------------------------------------------------------------
defaults
# running mode
mode http
# use global settings
log global
# get http request log
option httplog
# timeout if backends do not reply
timeout connect 300s
# timeout on client side
timeout client 300s
# timeout on server side
timeout server 300s
# timeout tunnel for websocket
timeout tunnel 3600s
# if using haproxy-version >= 2.*
# headers not case-sensetivity
#no option http-use-htx stats enable
stats hide-version
30 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
stats refresh 30s
stats show-node
stats auth admin:admin
stats uri /haproxy
option forwardfor
option http-server-close
errorfile 400 /usr/share/doc/packages/haproxy/examples/errorfiles/400.http
errorfile 403 /usr/share/doc/packages/haproxy/examples/errorfiles/403.http
errorfile 408 /usr/share/doc/packages/haproxy/examples/errorfiles/408.http
errorfile 500 /usr/share/doc/packages/haproxy/examples/errorfiles/500.http
errorfile 502 /usr/share/doc/packages/haproxy/examples/errorfiles/502.http
errorfile 503 /usr/share/doc/packages/haproxy/examples/errorfiles/503.http
errorfile 504 /usr/share/doc/packages/haproxy/examples/errorfiles/504.http
frontend http-in
bind *:80
bind *:443 ssl crt /etc/ssl/private/haproxy.<fqdn>.pem
# send x-forwarded-for header
option forwardfor
# log the name of the virtual server
capture request header host len 20
# log the amount of data uploaded during a post
capture request header content-length len 10
# log the beginning of the referrer
capture request header referer len 20
# server name (useful for outgoing proxies only)
capture response header server len 20
# logging the content-length is useful with "option logasap"
capture response header content-length len 10
# log the expected cache behaviour on the response
capture response header cache-control len 8
# the via header will report the next proxy's name
capture response header via len 20
# log the url location during a redirection
capture response header location len 20
# capture vkrest
capture request header x-transaction-id len 36
capture request header x-session-id len 36
capture response header x-transaction-id len 36
capture response header x-session-id len 36
acl https ssl_fc
acl is_websocket hdr(upgrade) -i websocket
# acl_administratos_uri_section start
# acl_administratos_uri_section end
# administratos_uri_network_alowed_section start
# administratos_uri_network_alowed_section end
# deny request rule start
# deny request rule end
# redirect http to https section start
redirect scheme https if !https !is_websocket
# redirect http to https section end
#websockets_auto_section_start
acl <id>_uri_path_beg /<id>
use_backend websocket_<id> if is_websocket <id>_uri_websocket
#websockets_auto_section_end
#licensing_auto_section_start
#licensinf_auto_section_end
#component_auto_section_start
acl configurator_uri_component path_beg /configurator
use_backend component_configurator if configurator_uri_component
acl mediastorage_uri_component path_beg /mediastorage
use_backend component_mediastorage if mediastorage_uri_component
acl security_uri_component path_beg /security
use_backend component_security if security_uri_component
#component_auto_section_end
# tomcat_auto_section_start
acl vkasr_uri_tomcat path_beg /vkasr
use_backend tomcat_vkasr if vkasr_uri_tomcat
acl vksession_uri_tomcat path_beg /vksession
use_backend tomcat_vksession if vksession_uri_tomcat
31 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
# tomcat_auto_section_end
# was_auto_section_start
# was_auto_section_end
# nginx_auto_section_start
acl webportal_uri_nginx path_beg /webportal
use_backend nginx_webportal if webportal_uri_nginx
# nginx_auto_section_end
# grafana_auto_section_start
# grafana_auto_section_end
# kibana_auto_section_start
# kibana_auto_section_end
# billing_section_start
# billing_section_end
default_backend default_backend_servers
backend default_backend_servers
mode http
balance source
option forwardfor
server default <fqdn>:8441 check
http-request set-header x-forwarded-port %[dst_port]
http-request add-header x-forwarded-proto https if { ssl_fc }
# backend_wbsocket_component_ section_start
backend websocket_<id>
server baada162-d64c-53a6-a16c-1e251e2c86f1 <fqdn>:9091 check
# backend_wbsocket_component_section_end
# backend_component_section_start
backend component_configurator
mode http
balance source
option forwardfor
server <id> <fqdn>:8082 check
http-request set-header x-forwarded-port %[dst_port]
http-request add-header x-forwarded-proto https if { ssl_fc }
backend component_mediastorage
mode http
balance source
option forwardfor
server <id> <fqdn>:8083 check
http-request set-header x-forwarded-port %[dst_port]
http-request add-header x-forwarded-proto https if { ssl_fc }
backend component_security
mode http
balance source
option forwardfor
server <id> <fqdn>:8086 check
http-request set-header x-forwarded-port %[dst_port]
http-request add-header x-forwarded-proto https if { ssl_fc }
# backend_component_section_end
# backend_tomcat_section_start
backend tomcat_vkasr
mode http
balance source
option forwardfor
server <id> <fqdn>:8080 check
http-request set-header x-forwarded-port %[dst_port]
http-request add-header x-forwarded-proto https if { ssl_fc }
backend tomcat_vksession
mode http
balance source
option forwardfor
server <id> <fqdn>:8080 check
http-request set-header x-forwarded-port %[dst_port]
http-request add-header x-forwarded-proto https if { ssl_fc }
# backend_tomcat_section_end
# backend_was_auto_section_start
# backend_was_auto_section_end
# backend_nginx_auto_section_start
backend nginx_webportal
mode http
32 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
balance source
option forwardfor
server webportal <fqdn>:8441 check # src webportal
http-request set-header x-forwarded-port %[dst_port]
http-request add-header x-forwarded-proto https if { ssl_fc }
# backend_nginx_auto_section_end
в файле:
– замените fqdn на полное имя домена или ip сервера, на котором установлен соответствующий
компонент (чтобы узнать fqdn сервера, воспользуйтесь командой hostname --fqdn);
– замените id на id компонента с websocket (чтобы узнать id сервера, воспользуйтесь
командой /opt/vk_cliscritsutility/scripts/conf.sh --host servername.com --port
8082 --user admin --password 123 components > rest_components. в файле
rest_compoments instances->id и расположен необходимый id);
– проверьте правильность путей к сертификату в секции frontend http-in конфигурационного файла.
конфигурационный файл /etc/haproxy/haproxy.cfg, указанный выше, является примером, в котором
описаны не все компоненты. по данному примеру необходимо описать все компоненты, для которых
требуется доступ с единой точкой входа (сервер, на котором развернут haproxy).
список всех серверов из секции backend конфигурационного файла и их состояние можно
посмотреть по ссылке:
https://<fqdn-haproxy>/haproxy , где fqdn-haproxy — доменное имя сервера с haproxy. при
авторизации используйте параметры конфигурационного файла.
утилита для конфигурирования vk_cliscritsutility, упомянутая выше, располагается в архиве prereq
дистрибутива. для получения справочной информации воспользуйтесь командой ./conf.sh --help.
ниже представлен текст справки:
syntax: ./conf.sh [options] action [argument]
list of action's:
components using without argument print names of all components in json format"
add additional argument \"available\" for list only components names available in configuration"
using with additional argument \"componentname\" show all instanceid and current status for this
component"
instances print all instances of the specified component
argument=component_name
get print json value of global/component/instance configuration
argument=path&path&path... (description of path is at the end)
set set the value to the global/component/instance configuration
argument=path:value&path:value... (description of path and value is at the end)
del delete the value of the global/component/instance configuration
argument=path&path&path... (description of path is at the end)
copy copy subtree(or value) from one location to the other
argument=path:path&path:path... (description of path and value is at the end)
del-instance delete the instance of the component
argument=component_name instance_id
general options:
-h, --help show help and exit
-v, --verbose print extra information
connection options:
-h, --host hostname, default: conf-host
-p, --port port, default: 8082
-u, --user username, default: configadmin
-p, --password password, default: 123
-e, --enc-pass the password is encrypted, default: the password is in plain text
-c, --context configurator web-context, default: /configurator
description of path
33 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
path is a list of json keys(or array indexes), separated by '|'. the first two positions in the
path are reserved for component name and instance name.
path = component|instance|path1|index|path2|path3 (where index - is a number)
examples:
'voice_grid|voice_grid_instance_1|message_queue|exchanges|management|name' - a path to the
management queue name of instance voice_grid_instance_1 of the voice_grid component
'configurator||tomcat' - a path to the common tomcat settings of the configurator component.
'||load_balancing' - a path to the global load balancing settings.
'||databases|0|credentials' - a path to the global database settings at index 0.
description of value
value can be a number, true/false, or a string . if value is a string, it should be in double
quotes
examples: 10, true, \"jdbc:oracle:thin:@//db-host:1521/xe\"
examples:
./conf.sh components
./conf.sh components available
./conf.sh components voice_grid
./conf.sh instances voice_grid
./conf.sh get \"voice_grid||load_balancing\"
./conf.sh set \"voice_grid||load_balancing|enabled:true\"
./conf.sh del \"voice_grid||load_balancing\"
./conf.sh copy \"||load_balancing:voice_grid||load_balancing\"
./conf.sh del-instance voice_grid ba049d35-6238-5d13-8103-78344f5e2bd6
6.3 установка с помощью ansible
для автоматизации установки компонентов комплекса можно воспользоваться системой ansible.
для использования плейбука необходимо установить:
1. ansible в соответствии с официальной документацией на сайте:
https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html
2. зависимости, приведённые в файле: .\ansible-main\requirements.txt. для установки модулей python
можно воспользоваться инструкцией https://pip.pypa.io/en/stable/installing/.
для корректного функционирования плейбука необходимо иметь доступ к хостам, на которых будет
выполнена установка через ssh с использованием ssh-ключа.
в параметре ansible_ssh_user: <имя пользователя> указывается от имени какого
пользователя будет произведена установка.
использование команды ansible-playbook:
ansible-playbook -i <путь_до_файла_инвентори\имя_файла_инвентори>
<путь_до_файла_плейбука\имя_файла_используемого_плейбука>
где ключ -i используется для указания файла инвентаризации.
с описанием всех ключей команды ansible-playbook можно ознакомиться по ссылке:
https://docs.ansible.com/ansible/latest/cli/ansible-playbook.html.
в файле .\ansible-main\readme.md приведены примеры использования плейбука и ссылки на файлы
с описанием использующихся ролей.
для использования плейбука необходимо создать инвентори-файл с перечнем необходимых для
развертывания параметров.
с типовым примером можно ознакомиться: .\ansible-main\example_inventory\combined.yml. в этом
файле также можно посмотреть комментарии к переменным, используемым в плейбуке. полная
инструкция по созданию инвентори-файлов доступна по адресу:
https://docs.ansible.com/ansible/latest/network/getting_started/first_inventory.html.
для плейбуков и инвентори-файлов используются .yml-файлы с использованием языка разметки
yaml. с документацией yaml можно ознакомиться по адресу: https://yaml.org/spec/1.2/spec.html.
34 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
для полной установки необходимо использовать плейбук .\ansible-main\all.yml.
примеры переменных
в блоке hosts указывается fqdn или ip-адрес целевого хоста. блок vars содержит переменные для
этого хоста.
set_vk_yum_package:<true\false> включает роль vk_yum_install
yum_rpm_list_installed:<список пакетов vk> список компонентов для установки ролью
vk_yum_install
add_lang_package:<список языковых пакетов> список языковых пакетов для asr/tts
webapp_list_installed:<список веб-приложений>
set_oraclexe18c:<true\false> включает роль установки oracledb xe 18c
set_pgsql_96:<true\false> включает роль установки postgresql 9.6
set_rabbitmq:<true\false> включает роль установки rabbitmq
set_mongodb:<true\false> включает роль установки mongodb
set_haproxy:<true\false> включает роль установки harpoxy
set_tomcat:<true\false> включает роль установки tomcat
set_devtools:<true\false> включает роль установки дополнительного по
devtools_yum_package_list:<список сторонних пакетов для установки>
set_prometheus_grafana:<true\false> включает роль установки prometheus и grafana
chrony_config_server:<адрес ntp сервера>
vk_mongo* параметры для mongodb
vk_db* параметры для postresql/oracledb
vk_platform_build_version* параметры, указывающие версию
блоки oraclexe и postgresql credentials должны содержать в себе учётные данные для
установки выбранной бд
при установке всей системы на один хост или использовании одного хоста для нескольких систем
необходимо обратить внимание на правильное переиспользование переменных.
6.4 установка сервисов и обработчиков вручную
скопируйте и установите пакеты необходимых компонентов комплекса с помощью команды
следующего вида:
rpm -uvh vk_asrprocessor-<version>.rpm
rpm -uvh vk_asrconstructorcliutil-<version>.rpm
rpm -uvh vk_bkkrtcprocessor-<version>.rpm
rpm -uvh vk_cachecomponent-<version>.rpm
rpm -uvh vk_chroniclercomponent-<version>.rpm
rpm -uvh vk_configuratorcomponent-<version>.rpm
rpm -uvh vk_databasecomponent-<version>.rpm
rpm -uvh vk_emoprocessor-<version>.rpm
rpm -uvh vk_facestcprocessor-<version>.rpm
rpm -uvh vk_facestcsdkprofiles-<version>.rpm
rpm -uvh vk_importertool-<version>.rpm
rpm -uvh vk_kerberosproxy-<version>.rpm
rpm -uvh vk_licensingcomponent-<version>.rpm
rpm -uvh vk_loadbalancercomponent-<version>.rpm
rpm -uvh vk_mediahubcomponent-<version>.rpm
rpm -uvh vk_mediastoragecomponent-<version>.rpm
rpm -uvh vk_monitoringcomponent-<version>.rpm
rpm -uvh vk_mrcpapplication-<version>.rpm
35 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
rpm -uvh vk_reportercomponent-<version>.rpm
rpm -uvh vk_rippercomponent-<version>.rpm
rpm -uvh vk_routercomponent-<version>.rpm
rpm -uvh vk_securitycomponent-<version>.rpm
rpm -uvh vk_siphonapplication-<version>.rpm
rpm -uvh vk_ttsstcprocessor-<version>.rpm
rpm -uvh vk_texttransformprocessor-<version>.rpm
rpm -uvh vk_vadprocessor-<version>.rpm
rpm -uvh vk_voicegridprocessor-<version>.rpm
rpm -uvh vk_voicegridsdkprofiles-<version>.rpm
rpm -uvh vk_voicekeyprocessor-<version>.rpm
rpm -uvh vk_voicerecognizerprocessor-<version>.rpm
6.5 установка веб-сервисов
установка веб-сервисов, необходимых для конкретного решения, приведена в документе
руководство администратора этого решения.
установка веб-сервисов, необходимых для всех решений, приведена ниже.
6.5.1 apache tomcat
установку apache tomcat можно выполнить с помощью утилиты yum:
yum -y install tomcat
также возможно скачать пакет с официального сайта и выполнить установку.
после установки убедитесь, что у пользователя tomcat есть права на следующие каталоги:
/etc/tomcat
/usr/share/java/tomcat
/var/log/tomcat
/var/cache/tomcat/temp
/var/lib/tomcat/webapps
/var/cache/tomcat/work
6.5.2 sessionservice application
sessionservice application разворачивается как веб-сервис в apache tomcat.
скопируйте файл vksession-<version>.war из дистрибутива и, убрав постфикс с версией при
копировании, поместите его в каталог <tomcat_directory>/webapps, где:
<tomcat_directory>: каталог установки apache tomcat.
6.5.3 groupservice application
groupservice application разворачивается как веб-сервис в apache tomcat.
скопируйте файл vkgroup-<version>.war из дистрибутива и, убрав постфикс с версией при
копировании, поместите его в каталог <tomcat_directory>/webapps, где:
<tomcat_directory>: каталог установки apache tomcat.
6.6 установка voicekey portal
установка voicekey portal выполняется в следующем порядке:
1. установите nginx (ознакомиться с документацией можно по ссылке: https://nginx.ru/ru/docs/).
2. отредактируйте основной конфигурационный файл /etc/nginx/nginx.conf, изменив содержимое на
следующее:
user nginx;
36 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;
# load dynamic modules. see /usr/share/nginx/readme.dynamic.
include /usr/share/nginx/modules/*.conf;
events {
worker_connections 1024;
}
http {
log_format main '$remote_addr - $remote_user [$time_local] "$request" '
'$status $body_bytes_sent "$http_referer" '
'"$http_user_agent" "$http_x_forwarded_for"';
access_log /var/log/nginx/access.log main;
sendfile on;
tcp_nopush on;
tcp_nodelay on;
keepalive_timeout 65;
types_hash_max_size 2048;
include /etc/nginx/mime.types;
default_type application/octet-stream;
# load modular configuration files from the /etc/nginx/conf.d directory.
# see http://nginx.org/en/docs/ngx_core_module.html#include
# for more information.
include /etc/nginx/conf.d/*.conf;
3. создайте конфигурационный файл /etc/nginx/conf.d/vk-nginx-app.conf со следующим содержимым:
server {
listen 8441 default_server;
server_name _;
root /opt/vk_httpapps/webportal;
location / {
}
error_page 404 /404.html;
location = /usr/share/nginx/html/40x.html {
}
error_page 500 502 503 504 /50x.html;
location = /usr/share/nginx/html/50x.html {
}
}
4. создайте каталог для веб-приложения voicekey portal с помощью команды:
mkdir -p /opt/vk_httpapps/webportal
5. скопируйте архив webportal-<version>.tar.gz из каталога vkapphttp дистрибутива, разархивируйте
его в /opt/vk_httpapps/webportal.
chown -r root:nginx /opt/vk_httpapps/
6. измените группу на nginx с помощью команды:
chown -r root:nginx /opt/vk_httpapps/
7. если отсутствует внешний прокси-сервер, на котором настроено корректное перенаправление
ссылок на компоненты комплекса voicekey.platform, для работы voicekey portal требуется
добавить в конфигурационный файл /etc/nginx/conf.d/vk-nginx-app.conf соответствующие блоки
(укажите имена хостов, на которых расположены компоненты, например: conf-host — хост сервера,
на котором расположен configurator component и т.д.):
server {
listen 8441 default_server;
server_name _;
root /opt/vk_httpapps/webportal;
location / {
37 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
}
error_page 404 /404.html;
location = /usr/share/nginx/html/40x.html {
}
error_page 500 502 503 504 /50x.html;
location = /usr/share/nginx/html/50x.html {
}
location /configurator/ {
proxy_pass http://conf-host:8082/configurator/;
}
location /vksession/ {
proxy_pass http://tomcat-host:tomcat-port/vksession/;
}
location /security/ {
proxy_pass http://security-host:8086/security/;
}
location /mediastorage/ {
proxy_pass http://ms-host:8083/mediastorage/;
}
location /vktracker/ {
proxy_pass http://tomcat-host:tomcat-port/vktracker/;
}
location /vkgroup/ {
proxy_pass http://tomcat-host:tomcat-port/vkgroup/;
}
location /vktts/ {
proxy_pass http://tomcat-host:tomcat-port/vktts/;
}
location /reporter/ {
proxy_pass http://reporter-host:8085/reporter/;
}
location /vkvocabulary/ {
proxy_pass http://tomcat-host:tomcat-port/vkvocabulary/;
}
}
8. настройте nginx на автоматический запуск при запуске сервера с помощью команды:
systemctl enable nginx
9. перезапустите nginx с помощью команды:
systemctl restart nginx
6.7 установка из yum-репозитория
для установки компонентов комплекса с помощью yum требуется наличие центрального репозитория.
для установки компонентов комплекса с помощью yum выполните команду вида:
yum install <vk_componentname1> <vk_componentname2> <vk_componentname3>
например:
yum install vk_cachecomponent vk_configuratorcomponent vk_databasecomponent vk_facestc processor
vk_licensingcomponent vk_rippercomponent vk_routercomponent vk_voicekeyprocessor
vk_chroniclercomponent vk_mediastoragecomponent vk_monitoringcomponent vk_securitycomponent
38 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
6.8 настройка через configurator component
в основу механизма управления конфигурацией voicekey.platform заложен принцип
иерархического распределения значений параметров действующей конфигурации:
– на глобальном уровне хранятся значения параметров общие для всех компонентов платформы;
– на уровне компонентов хранятся значения параметров общие для компонентов определённого
вида;
– на уровне экземпляров хранятся настройки специфические для конкретного экземпляра
компонента.
6.8.1 предварительная настройка
для получения своих настроек компоненты подключаются к компоненту конфигурации. при этом
используются настройки подключения, указанные в индивидуальном файле конфигурации каждого
компонента:
/opt/vk_<сomponentname>/conf/application.json
<componentname> — имя сервиса или обработчика
файл конфигурации сервиса или
процессора.
создаётся после установки
компонента.
<tomcat_directory>/conf/vksession-config.json
<tomcat_directory>/conf/vkgroup-config.json
<tomcat_directory> — каталог установки apache tomcat
файлы конфигурации веб-сервисов
sessionservice application и
groupservice application.
создаются после первого запуска веб-
сервиса.
файлы конфигурации содержат настройки подключения к configurator component:
{
"configurator_endpoint": {
"host": "conf-host",
"port": 5566
}
}
измените значение параметра host на имя или ip-адрес сервера, на котором установлен
configurator component.
для настройки конфигуратора также можно воспользоваться командой:
find /opt -name "application.json" -print | xargs sed -i "s/conf-host/<hostname>/g"
где <hostname> — имя сервера, на котором установлен компонент конфигурации.
запустите configurator component командой systemctl start vk_configuratorcomponent и
выполните необходимую настройку компонента конфигурации с помощью веб-интерфейса voicekey
portal или команд:
1. войдите в веб-интерфейс: http://<host>:8082/configurator/, где <host> — имя вашего сервера. для
входа используйте учётные данные по умолчанию: логин configadmin, пароль 123. учётные
данные можно изменить (см. настройка учётных данных configurator component).
39 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
настройте configurator component. для всех компонентов комплекса замените следующие
параметры в глобальных настройках:
– в configurator_endpoint> host замените conf-host на имя или ip-адрес сервера, на
котором установлен configurator component;
– в databases> url при необходимости скорректируйте url для подключения к бд (имя или ip-
адрес сервера, порт, имя бд);
– в licensing> host замените lic-host на имя или ip-адрес сервера, на котором установлен
licensing component;
– в message_queue> endpoint замените mq-host на имя или ip-адрес сервера, на котором
установлен rabbitmq;
– в mongo> connection_string замените mongo-host на имя или ip-адрес сервера, на
котором установлен mongodb.
2. для настройки с помощью команд выполните следующие команды, заменив <hostname> на имя
сервера, на котором установлен соответствующий компонент:
find /opt -name "application.json" -print | xargs sed -i "s/lic-host/{hostname}/g"
find /opt -name "application.json" -print | xargs sed -i "s/db-host/{hostname}/g"
find /opt -name "application.json" -print | xargs sed -i "s/mq-host/{hostname}/g"
find /opt -name "application.json" -print | xargs sed -i "s/mongo-host/{hostname}/g"
3. после настройки запустите все остальные компоненты (см. запуск компонентов ) и дождитесь,
пока компоненты зарегистрируются в конфигураторе и примут настройки (данная операция
занимает от 3 до 5 минут).
6.8.2 веб-интерфейс configurator component
настройки всех компонентов комплекса задаются через веб-интерфейс компонента конфигурации.
для перехода к пользовательскому интерфейсу укажите в адресной строке браузера следующий
адрес:
https://<host>:<port>/, где:
– <host>: имя или ip-адрес сервера, на котором установлен voicekey portal.
– <port>: порт для подключения к voicekey portal (индивидуально для каждой установки комплекса,
см. раздел установка voicekey portal документа voicekey.platform руководство по установке и
настройке).
нажмите кнопку и авторизуйтесь с помощью данных, установленных по умолчанию: логин
configadmin, пароль 123. учётные данные можно изменить (см. настройка учётных данных configurator
component).
после выполнения настройки компонентов рекомендуется перезапустить все компоненты.
внешний вид интерфейса компонента конфигурации представлен на рисунке 1.
40 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
рисунок 1 — внешний вид конфигуратора
1 — вкладка настройки.
2 — глобальные настройки используются для настройки всего комплекса в целом и отображаются в
поле 8. в дальнейшем эти настройки можно применить к компонентам и к серверам. для каждого
компонента и сервера можно выполнить индивидуальную настройку. в некоторых случаях для серверов
возможно применять настройки компонентов.
3 — вкладка компоненты.
вкладка содержит группы настроек, каждая из которых соответствует установленному компоненту
комплекса.
внутри каждой группы отображаются серверы, на которых установлены соответствующие
компоненты.
при нажатии на компонент или сервер в поле 8 отображаются доступные для настройки параметры.
4 — поиск компонента.
5 — вкладка серверы. вкладка имеет обратную структуру относительно вкладки компоненты и
содержит секции, каждая из которых соответствует серверу, входящему в состав комплекса.
внутри каждой секции отображаются экземпляры компонентов, которые установлены на
соответствующие серверы.
при нажатии на сервер или компонент в поле 8 отображаются доступные для настройки параметры.
6 — вкладка файлы.
7 — кнопка сохранения изменений.
8 — поле с глобальными настройками или с доступными настройками для выбранного компонента /
сервера.
9 — выбранный для настройки компонент или сервер.
10 — авторизация в voicekey portal.
11 — смена языка интерфейса.
41 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
12 — выход из конфигуратора.
13 — номер версии voicekey.platform.
после внесения изменений на странице необходимо нажать кнопку сохранить. в случае перехода на
другую веб-страницу без нажатия кнопки сохранить внесённые изменения будут потеряны.
6.8.3 глобальные настройки
перейдите в глобальные настройки и настройте необходимые параметры.
рисунок 2 — глобальные настройки
кнопка служит для очистки введённой в поле информации.
кнопка служит для возврата настроек к последним сохранённым значениям.
кнопка служит для добавления нового параметра.
кнопка служит для удаления параметра.
внесите необходимые изменения и нажмите кнопку сохранить.
6.8.3.1 audit
параметр описание
buffer_size количество накопленных сообщений для передачи chronicler component.
enabled включен/выключен.
level уровень логирования, определяющий тип событий, начиная с которых
сохраняются в базе данных.
42 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
6.8.3.2 cache
параметр описание
type тип, может быть только redis.
timeouts string_entry время жизни строковых данных в redis.
transaction_entry время жизни транзакционных данных в redis.
redis json-конфигурация redisson клиента для redis (см. документацию redisson).
large_data_caching настройки кэширования больших сообщений, посылаемых через rabbitmq.
enabled флаг, включающий/выключающий кэширование.
min_message_size_kb минимальный размер сообщения в килобайтах,
начиная с которого происходит это кэширование.
6.8.3.3 component_id
секция используется для каждого из компонентов при условии, что включён технологический
мониторинг.
параметр описание
component имя компонента для регистрации в менеджере мониторинга monitoring
component.
info информация о компоненте, которая отображается в виде подсказки в списке
экземпляров компонента.
instance идентификатор экземпляра компонента.
ip ip-адрес экземпляра компонента.
6.8.3.4 component_state
параметр описание
synchronization настройка синхронизации внутреннего состояния компонентов.
synchronization.enabled флаг, включающий/выключающий синхронизацию.
synchronization.history сохранение истории операций.
max_age время хранения истории операций (в секундах).
max_length максимальное количество сохранённых операций.
6.8.3.5 configurator_endpoint
настройки подключения к компоненту конфигурации.
параметр описание
host имя или ip-адрес сервера, на котором установлен компонент конфигурации.
43 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
port порт для подключения к компоненту конфигурации.
6.8.3.6 databases
настройки подключения к базам данных.
параметр описание
credentials реквизиты доступа для подключения к бд.
username имя пользователя.
password пароль пользователя.
id идентификатор бд.
url адрес подключения к бд.
pool блок настроек пула подключений к бд.
idle_connection_test_
period
время (в секундах), в течение которого будут
проверяться незарегистрированные
подключения.
max_pool_size максимальное количество одновременных
подключений. значение по умолчанию 15.
min_pool_size минимальное количество одновременных
подключений.
test_connection_on_
checkin
проверка доступности подключения.
true: проверка осуществляется асинхронно
при регистрации подключений.
test_connection_on_
checkout
проверка доступности подключения.
true: операция выполняется при проверке
подключения.
timeout время (в секундах), в течение которого
неиспользуемые подключения будут
храниться перед удалением. по умолчанию
срок хранения подключений не истекает.
6.8.3.7 engine_provider
параметр описание
face_provider выбор обработчика запросов верификации по изображению лица.
6.8.3.8 licensing
настройки подключения к менеджеру лиенций.
параметр описание
44 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
client_count количество клиентов для одновременной проверки лицензирования.
host имя или ip-адрес компьютера, на котором установлен менеджер лицензий.
port порт для подключения к менеджеру лиенций.
service_id идентификатор сервиса для ограничений действий пользователя.
6.8.3.9 load_balancing
настройки балансировщика загрузки.
параметр описание
enabled включен/выключен.
ping_interval интервал опроса балансировщика клиентом (в миллисекундах).
6.8.3.10 maintenance
параметр описание
deadlock_detector_
enabled
флаг, позволяющий отслеживать взаимную блокировку в лог-файлах
компонентов.
profiler_enabled сбор расширенных характеристик работы компонентов, позволяющих
отслеживать их производительность.
true: сведения будут сохраняться в лог-файлы компонентов.
данная опция предусмотрена только для отладки; не рекомендуется включать
её в ходе эксплуатации.
profiler_interval периодичность сохранения данных профилирования в лог-файлы компонентов
(в миллисекундах).
6.8.3.11 message_queue
настройки шины данных.
параметр описание
credentials реквизиты доступа для подключения к шине данных.
username имя пользователя.
password пароль пользователя.
dispatch_pool настройки пула потоков-обработчиков сообщений:
core_pool_size минимальное количество потоков в пуле.
maximum_pool_
size
число, до которого может увеличиваться количество
потоков в пуле при увеличении нагрузки.
keep_alive_time_
sec
время жизни бездействующих потоков (в секундах).
45 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
endpoint настройки подключения к серверу, на котором установлена шина данных.
host имя или ip-адрес сервера.
port порт для подключения к серверу.
exchanges настройки обмена сообщениями, передаваемыми через шину.
не рекомендуется вносить изменения.
logging логирование сообщений.
не рекомендуется включать логирование во избежание переполнения базы
данных. логирование предусмотрено только для отладки.
enabled включение/отключение логирования.
true: все сообщения, передаваемые между
компонентами системы, сохраняются в бд.
nats.ssl настройка шифрования трафика.
cipher_suite установка списка доступных алгоритмов
шифрования.
context_type тип протокола.
enable включение/выключение ssl.
fips_enabled проверка на соответствие стандарту «fips
140 — security requirements for cryptographic
modules».
key_store настройки хранилища ключей.
file
файл хранилища.
password
пароль для файла хранилища.
type
тип хранилища.
trusted_store настройки доверенного хранилища ключей.
file
файл хранилища.
password
пароль для файла хранилища.
type
тип хранилища.
pool настройки пула подключения к провайдеру.
46 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
minimum_size минимальный размер пула.
maximum_size максимальный размер пула (если значение
параметра не задано, то количество подключений не
ограничено).
timeout время бездействия подключения, по истечении
которого подключение автоматически закрывается (в
секундах).
rabbit специфические настройки rabbitmq (используются, если шина построена на
базе по rabbitmq).
virtual_host виртуальный хост rabbitmq.
ssl настройка шифрования трафика (см. nats.ssl).
timeouts время ожидания ответных сообщений (в миллисекундах), по истечении
которого соединение разрывается.
unicast при передаче сообщений единственному адресату.
broadcast при широковещательной передаче сообщений.
inactivity при опросе компонентов для проверки их
активности.
ttl в очереди rabbitmq (см. ttl).
type тип связующего по, установленного в составе voicekey.platform:
rabbit_mq.
параметры секции ttl
параметр описание
queue timeout время жизни сообщения в очереди rabbitmq (в
миллисекундах).
enabled включение/выключение установки заголовка xmessage-
ttl в очередях.
message enabled включение/выключение функциональности,
связанной с ограничением времени жизни
сообщения на уровне приложения. для её
использования необходимо синхронизировать
время на машинах, входящих в комплекс.
6.8.3.12 mongo
настройки подключения к mongodb.
47 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
credentials реквизиты доступа для подключения к базе данных.
username имя пользователя.
password пароль пользователя.
connection_string адрес подключения компонентов к mongodb.
6.8.3.13 mongo_saver
настройка логирования полученных от клиента файлов в mongodb.
параметр описание
application_token идентификатор, добавляемый в метаданные сохранённого файла, для
определения приложения, в котором был получен файл.
is_enabled включение/выключение логирования файлов в mongodb.
memory_limit максимальное количество файлов, поставленных в очередь на запись в
mongodb.
6.8.3.14 monitoring
настройки менеджера мониторинга.
параметр описание
enabled включение технологического мониторинга компонентов комплекса.
true: мониторинг включён.
false: мониторинг отключён.
при false monitoring component не используется.
monitoring_settings настройки мониторинга.
dead_time время бездействия компонента в секундах, по истечении
которого компонент считается неактивным.
ping_timeout периодичность (в секундах) отправки сообщений
keepalivemessage.
6.8.3.15 ports
настройки диапазона портов, которые будут использоваться для записи звуковых данных из телефонной
линии (необходимо указать только для компонента cache component в секции components).
параметр описание
port_from начало диапазона.
по умолчанию: 8000.
port_to конец диапазона.
по умолчанию: 9000.
48 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
host ip-адрес или имя сервера, на котором открыты порты для записи звуковых
данных из телефонной линии.
max_connections_per_port максимальное количество соединений на один порт.
6.8.3.16 resampling
настройка передискретизации для уменьшения размера файла.
параметр описание
is_resampler_enabled флаг, включающий/выключающий передискретизацию.
target_sample_rate требуемая частота дискретизации (в герцах).
6.8.3.17 quality_metrics
настройки характеристик изображений для voicekey.inspector.
подробное описание параметров представлено в документе «voicekey.inspector. руководство
администратора».
6.8.3.18 ripper
настройки утилит ffmpeg для работы с медиаресурсами.
параметр описание
ffmpeg_path путь к утилите ffmpeg.
ffprobe_path путь к утилите ffprobe.
6.8.3.19 security
параметр описание
sessions настройки сессии.
ping_timeout интервал проверки сессий на активность (в
секундах). если в течение ping_timeout не было
активности, сессия будет завершена. по умолчанию
1800.
cryptography настройки шифрования.
encrypt_models блок шифрования шаблонов в бд.
algorithm тип алгоритма.
password пароль.
key_length длина ключа шифрования.
enabled флаг, включающий/выключающий шифрование
шаблонов.
49 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
compression_enable
d
флаг, включающий/выключающий режим сжатия
данных.
enabled флаг, включающий защищённый режим, при котором все действия с
комплексом выполняются в рамках пользовательских сессий.
при false security component не используется.
6.8.3.20 sound_logging
настройки логирования информации о записи звуковых данных.
параметр описание
save_to_directory сохранение звуковых данных локально, в заданную директорию.
enabled флаг, включающий/выключающий логирование.
не рекомендуется включать логирование во избежание
переполнения базы данных. логирование предусмотрено для
отладки.
destination полный путь к директории, в который сохраняются записи
звуковых данных.
save_to_media_
storage
сохранение звуковых данных в mediastorage component.
enabled флаг, включающий/отключающий логирование звука в
mediastorage component.
6.8.3.21 tcp_data_hub
настройка внутреннего механизма передачи больших данных между компонентами по протоколу
tcp.
не рекомендуется вносить изменения.
6.8.3.22 storage
параметр описание
bucket название бакета в mongodb.
connection_string строка подключения (при type — mongo) / путь к каталогу (file_system).
credentials реквизиты доступа для подключения к mongodb.
password пароль.
username имя пользователя.
saver настройка сохранения полученных файлов в mediastorage component.
50 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
application_token токен, добавляемый в метаданные сохранённого
файла, для определения приложения, из которого был
получен файл.
is_enabled флаг, включающий/выключающий сохранение файлов.
memory_limit лимит памяти очереди на сохранение (в байтах).
swap настройки резервного хранилища. файлы
записываются в swap, если лимит памяти очереди
memory_limit исчерпан.
is_enabled
флаг, включающий/отключающий резервное
хранение.
memory_limit
лимит памяти резервного хранилища на диске (в
байтах).
path
путь к каталогу для сохранения файлов.
type тип хранилища.
mongo: mongodb.
file_system: файловая система.
6.8.4 файловое хранилище
в файловое хранилище добавляются файлы сертификатов, хранилища и другие.
перейдите в блок файлы веб-интерфейса компонента конфигурации.
внешний вид блока представлен на рисунке 3.
рисунок 3 — блок файлы веб-интерфейса общего конфигуратора
для добавления файлов в хранилище нажмите загрузить и с помощью стандартного проводника
выберите файлы, которые необходимо добавить. или перетащите файлы в соответствующее поле. после
добавления файлы и их общее количество отобразятся в правой части блока.
для удаления файлов установите флажок напротив каждого файла, который требуется удалить.
нажмите удалить.
51 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
6.8.5 индивидуальные настройки компонентов
вкладка компоненты содержит группы настроек, каждая из которых соответствует установленному
компоненту комплекса.
внутри каждой группы отображаются серверы, на которых установлены соответствующие
компоненты.
для индивидуальной настройки компонента выберите в поле 3 (см. веб-интерфейс configurator
component) компонент для настройки. в поле 8 отобразятся параметры, специфические для компонента.
перейдите к настраиваемому параметру в поле 8 и разверните его:
рисунок 4 — секция для индивидуальной настройки компонента
в зависимости от типа параметра введите в поле значение параметра, выберите значение из
выпадающего списка или установите ползунковый переключатель в соответствующее положение.
кнопка g служит для заполнения поля данного параметра значением из глобальных настроек.
кнопка служит для очистки введённой в поле информации.
кнопка служит для возврата настроек к последним сохранённым значениям.
кнопка служит для добавления нового параметра.
кнопка служит для удаления параметра.
внесите необходимые изменения и нажмите кнопку сохранить.
6.8.5.1 configurator component
чтобы настроить configurator component, выберите configurator в списке компонентов.
специфические параметры configurator component настраиваются в секциях:
– calibration_utility: настройки утилиты калибровки.
– configurator_users: управление пользователями configurator component.
– configurator_settings: настройки configurator component.
– tomcat: общие настройки сервера и массива с коннекторами.
52 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметры секции calibration_utility
параметр описание
ethalon_model_count количество файлов для построения модели эталона.
min_segmentation минимальная сегментация.
parallel_tasks количество заданий, выполняющихся одновременно.
plot_rate шаг делений по оси х.
storage_path путь к каталогу хранилища загружаемых файлов.
threads_per_task количество потоков, использующихся в одном задании.
credentials параметры аутентификации.
domain идентификатор домена.
user имя пользователя.
password пароль пользователя.
параметры секции configurator_users
параметр описание
username имя пользователя.
password пароль.
параметры секции configurator_settings
параметр описание
disable_help отключение swagger документации для configurator component.
session_timeout_min период бездействия пользователя (в минутах), после которого текущая сессия
будет завершена.
параметры секции tomcat
параметр описание
base_dir рабочая директория tomcat (временная директория в tmp).
connectors раздел настройки http/https коннекторов.
enabled отключение/включение коннектора.
keystore_file файл сертификата.
keystore_pass пароль хранилища ключей сервера.
53 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
params список параметров (см. документацию tomcat).
port открываемый порт, порт первого коннектора - порт
по умолчанию;
secured тип коннектора.
true: https.
false: http.
truststore_file файл сертификата.
trustore_pass пароль хранилища ключей с доверенными
клиентскими сертификатами.
doc_base директория со статическими файлами (временная директория в tmp).
enabled включение/отключение встроенного tomcat.
host хост по умолчанию.
при наличии у сервера более одного ip, также может быть сконфигурирован на
уровне коннектора.
web_context контекст веб-приложения.
6.8.5.2 reporter component
для настройки reporter component выберите reporter в списке компонентов.
специфические параметры reporter component настраиваются в секциях:
– application: настройки reporter component
– databases: настройки подключения к базам данных. см. databases в разделе глобальные настройки.
при использовании бд, указанной в глобальных настройках, значение id в настройках reporter
component и глобальных настройках должны совпадать. если остальные параметры совпадают с
глобальными настройками, их можно не задавать.
– tomcat: общие настройки сервера и массива с коннекторами. cм. tomcat в configurator component
параметры секции application
параметр описание
domain идентификатор домена, указывающий на данные, с которыми будет работать
система. домен представляет собой часть базы данных биометрических
моделей.
exported_reports
_directory_path
корневой каталог, в котором хранятся файлы с отчётами, созданными по
расписанию.
scheduler_retry раздел настройки повторного запуска создания отчёта по расписанию в случае
ошибки.
54 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
delay_minutes период отсрочки повторного создания отчёта (в
минутах).
times количество попыток.
thread_number количество потоков при создании отчётов.
6.8.5.3 security component
чтобы настроить security component, выберите security в списке компонентов.
специфические параметры security component настраиваются в секциях:
– tomcat: общие настройки сервера и массива с коннекторами. cм. tomcat в configurator component.
– user_directories: настройки директорий пользователей. содержит следующие блоки настроек:
блок описание
database_directory настройки бд директории. аутентификация и авторизация происходит по
должностям и паролям, хранимым в бд voicekey.
ldap_directory настройки ldap директории. аутентификация выполняется через ldap.
авторизация происходит за счёт групп ldap, сопоставленных с должностями.
root_directory настройки директории суперпользователя, необходимого для выполнения
предварительной настройки security component.
параметры блока database_directory
параметр описание
authentication настройки параметров аутентификации.
authentication_failure
_timeout
время, по истечении которого сбрасывается
счётчик неуспешных попыток авторизации, если
не было превышено
max_authentication_failures (в секундах).
max_authentication_
failures
максимальное количество попыток
неправильного ввода паролей. при превышении
пользователь будет заблокирован.
enabled включение/выключение директории.
is_default назначить директорией по умолчанию. если при создании пользователя не
передан идентификатор директории, пользователь будет создан в директории
по умолчанию.
password настройки сложности пароля.
см. параметры блока password.
55 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметры блока password
параметр описание
characters настройки используемых в пароле символов.
digits требуемое количество цифр в пароле (если не
указано или 0 — цифры не требуются).
symbols требуемое количество спецсимволов в пароле
(если не указано или 0 — спецсимволы не
требуются)
uppercase требуемое количество заглавных букв в пароле
(если не указано или 0 — заглавные буквы не
требуются).
lowercase требуемое количество строчных букв в пароле
(если не указано или 0 - строчные буквы не
требуются).
length настройка длины пароля пользователя.
max максимально допустимая длина пароля
пользователя (если не указана, то максимальная
длина пароля не ограничивается).
min минимально допустимая длина пароля
пользователя.
password_hash_cipher пароль, которым шифруются хэши паролей, хранимых в бд.
update настройки обновления пароля пользователя.
last_unique_passwords количество последних паролей пользователя, на
которые невозможно сменить текущий.
period период обновления паролей согласно iso 8601.
required настройка режима обновления пароля по
истечении установленного периода времени:
true: периодическая смена паролей
обязательна.
false: смена пароля необязательна.
параметры блока ldap_directory
параметр описание
enabled включение/выключение директории.
56 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
is_default назначить директорией по умолчанию. если при создании пользователя не
передан идентификатор директории, пользователь будет создан в директории
по умолчанию.
ldap_connection настройки используемые для подключения к ldap.
authentication механизм аутентификации, используемый при
подключении к серверу ldap.
bind_dn dn пользователя, от имени которого будут
выполняться запросы к ldap.
при создании пользователя в activedirectory
необходимо снять флаг user must change
password at next login, и установить флаг
password never expires.
bind_password пароль пользователя, от имени которого будут
выполняться запросы к ldap.
connect_timeout время ожидания подключения к серверу ldap.
pool настройки пула подключений. см. параметры
блока pool.
response_timeout времени ожидания ответа от сервера ldap.
server_type тип сервера ldap. от данного параметра зависит
использование специализированных функций,
доступных только в конкретных реализациях.
ssl настройки ssl. см. параметры блока ssl.
url url, используемый для подключения к серверу
ldap.
schema настройки схемы ldap.
additional_group_dn параметр используется в дополнение к base_dn
при поиске и загрузке групп. если значение не
указано, поиск по поддереву начнётся с
base_dn.
additional_user_dn параметр используется в дополнение к base_dn,
при поиске и загрузке пользователей. если
значение не указано, поиск по поддереву
начнётся с base_dn.
57 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
all_users_group_dn dn группы, содержащей всех активных
пользователей. если пользователь находится в
данной группе и в какой-либо группе,
сопоставленной с должностью, то он будет
создан на стороне платформы.
если необходимо сделать пользователя
неактивным, достаточно удалить его из данной
группы.
base_dn корневое уникальное имя (dn), используемое
при выполнении запросов к серверу каталогов.
group_schema настройки схемы ldap, относящиеся к группам.
см. параметры блока group_schema.
membership_schema настройки схемы ldap, относящиеся к атрибутам
членства пользователя в группе. см. параметры
блока membership_schema.
user_schema настройки схемы ldap, относящиеся к
пользователю. см. параметры блока user_schema.
synchronization настройки синхронизации структуры должностей и пользователей с ldap.
enable включение/выключение режима синхронизации.
interval интервал синхронизации (в миллисекундах).
параметры блока pool
параметр описание
min_pool_size минимальный (начальный) размер пула подключений.
max_pool_size максимальный размер пула подключений.
block_timeout время ожидания доступного подключения из пула (в секундах).
параметры блока ssl
параметр описание
allow_any_certificate доверять любому сертификату. рекомендуется использовать данную настройку
только на тестовом окружении.
allow_any_hostname отключить проверку имени хоста. рекомендуется использовать данную
настройку только на тестовом окружении.
58 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
cred_source тип хранилища сертификатов.
keystore: использовать java keystore.
x509: использовать сертификат x509.
none: не использовать сертификат.
keystore_settings настройки хранилища ключей.
keystore_path путь к файлу-хранилищу.
указание префикса file: обязательно.
use_ssl использовать ssl при подключении к серверу ldap.
use_start_tls использовать starttls при подключении к серверу ldap.
x509_settings настройки хранилища ключей x509.
trust_certificates файл с доверенными сертификатами. указание
префикса file: обязательно.
authentication_
certificate
файл с сертификатом клиента. указание префикса
file: обязательно.
authentication_key файл с приватным ключом клиента. указание
префикса file: обязательно.
параметры блока group_schema
параметр описание
group_name_attribute имя атрибута группы, используемое при определении имени группы.
group_object_class имя класса, используемого для объекта группы ldap.
group_object_filter фильтр, используемый для фильтрации групп.
параметры блока membership_schema
параметр описание
group_members_attribute имя атрибута группы, используемое при определении пользователей,
являющихся членами группы.
user_membership_attribut
e
имя атрибута пользователя, используемое при определении групп, в которых
состоит пользователь.
параметры блока user_schema
параметр описание
user_auth_filter фильтр ldap, используемый для аутентификации пользователя.
user_object_class имя класса, используемого для объекта пользователя ldap.
59 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
user_uuid_attribute имя атрибута пользователя, используемое при загрузке уникального
идентификатора.
user_name_attribute имя атрибута пользователя, используемое при загрузке имени пользователя.
user_first_name_attribute имя атрибута пользователя, используемое при загрузке имени.
user_last_name_attribute имя атрибута пользователя, используемое при загрузке фамилии.
user_display_name_attribut
e
имя атрибута пользователя, используемое при загрузке фио (отображаемого
имени).
user_email_attribute имя атрибута, используемое при загрузке почтового адреса.
параметры блока root_directory
параметр описание
enabled включение/выключение директории. после завершения предварительной
настройки security component рекомендуется выключить директорию.
password пароль суперпользователя.
username имя суперпользователя.
6.8.5.4 asr processor
чтобы настроить asr processor, выберите asr в списке компонентов.
специфические параметры asr processor настраиваются в секциях sdk_asrstc, asr_defaults и
result_logging.
параметры секции sdk_asrstc
параметр описание
cache настройки кэша данных.
enabled сохранение в локальном кэше каждого шаблона,
полученного sdk из бд. при следующем обращении к
данному шаблону операции с ней проводятся быстрее.
max_age время (в секундах), по истечении которого шаблон из кэша
будет проверен на обновление.
update настройки автообновления данных.
enabled
флаг, включающий/отключающий автообновление данных
из бд.
group_upload_pack_size
60 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
количество шаблонов, загружаемых за одну итерацию при
загрузке группы из бд.
group_upload_threads
количество потоков при загрузке группы из бд.
pack
количество шаблонов, обновляемых автоматически за одну
итерацию.
period
период опроса бд при автообновлении (в миллисекундах).
capacity настройки хранения шаблонов в кэше.
value
максимальное количество шаблонов в кэше.
free_factor
процент, на который сокращается количество шаблонов в
кэше при достижении value.
engines_count количество обработчиков.
параметры секции result_logging
параметр описание
enabled включение/выключение логирования распознанного текста. по умолчанию
отключено.
параметры секции asr_defaults
параметр описание
default_packages используемые пакеты распознавания.
поле key предназначено для ввода режима распознавания:
online: режим реального времени;
offline: режим постобработки;
ivr: режим реального времени для диалоговых систем.
поле value предназначено для ввода наименования пакета распознавания.
default_transformation_mo
del
модель для работы сервиса свёртки результата для пакетов, в которых
требуется этот сервис
local_mode флаг включения синхронизации кэша графов с mediastorage component:
true: mediastorage component используется;
false: mediastorage component не используется.
61 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
6.8.5.5 facestc processor
чтобы настроить facestc processor, выберите face_stc в списке компонентов.
специфические параметры facestc processor настраиваются в сеции sdk_facestc.
параметр описание
admissible_issues максимальное количество допустимых ошибок при работе детектора живого
пользователя.
alternative_profile используется voicekey.inspector для предварительного поиска лиц.
cache настройки кэша данных (см. cache в asr processor).
config_file_path путь к каталогу с конфигурационными файлами sdk.
engines_count количество обработчиков.
fix_desynchronization компенсация рассинхронизации видео- и аудиопотоков при работе детектора
живого пользователя.
если данная функциональность включена, работа детектора живого человека
будет менее производительной.
liveness_language язык биометрии по умолчанию.
ru: русский.
en: английский.
pt: португальский.
ko: корейский.
liveness_type выбор алгоритма работы детектора живого пользователя.
возможные значения: auto, bimodal.
рекомендуется установить значение bimodal.
portrait_characteristics настройки портретных характеристик.
angle_roll_threshold допустимый угол отклонения головы
(влево/вправо) в градусах.
dark_glasses_threshold порог, при котором определяются тёмные очки.
принимает значение от 0 (нет тёмных очков) до
1 (есть тёмные очки).
eye_open_threshold порог, при котором считается, что оба глаза
открыты.
параметр принимает значение от 0 (глаза
закрыты) до 1 (глаза полностью открыты).
frontal_pose_deviation_
threshold
допустимый наибольший угол поворота головы
влево/вправо и наклона головы вниз/вверх в
градусах.
62 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
profile набор настроек, необходимый для инициализации sdk.
при изменении профиля необходимо перезагрузить facestc processor.
6.8.5.6 tts processor
чтобы настроить tts processor, выберите tts_stc в списке компонентов.
специфические параметры tts processor настраиваются в секции sdk_ttsstc.
параметр описание
vendor выбор вендора синтеза. после изменения настройки необходимо
перезагрузить tts processor
возможные значения:
speechpro
readspeaker
cache настройки кэша данных.
enabled сохранение в локальном кэше каждого шаблона,
полученного sdk из бд. при следующем обращении к
данному шаблону операции с ней проводятся быстрее.
max_age время (в секундах), по истечении которого шаблон из кэша
будет проверен на обновление.
update настройки автообновления данных.
enabled
флаг, включающий/отключающий автообновление данных из
бд.
group_upload_pack_size
количество шаблонов, загружаемых за одну итерацию при
загрузке группы из бд.
group_upload_threads
количество потоков при загрузке группы из бд.
pack
количество шаблонов, обновляемых автоматически за одну
итерацию.
period
период опроса бд при автообновлении (в миллисекундах).
capacity настройки хранения шаблонов в кэше.
value
максимальное количество шаблонов в кэше.
free_factor
63 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
процент, на который сокращается количество шаблонов в
кэше при достижении value.
heavy_cache флаг, отвечающий за включение «тяжёлого кэша». подразумевает отключение
стандартной политики сброса кэша голоса, в случае если данный голос не
используется ни одним из инициализированных процессоров.
engines_count количество обработчиков.
max_text_size_in_symbols максимальный размер текста в символах.
значение по умолчанию: 300.
sdk_logging настройка уровня логирования sdk.
sdk_log_
backup_
number
количество бэкап-файлов.
принимает значение от 1 включительно.
sdk_log_file путь к каталогу, в который будут записываться лог-файлы.
каталог необходимо предварительно создать.
по умолчанию: пустой (лог-файлы не ведутся).
sdk_log_
file_size
максимальный размер файла, по достижении которого
создастся бэкап-файл или обнулится текущий.
sdk_log_level уровень логирования:
off: логирование отключено;
debug: сообщения, полезные для отладки;
info: сообщения о штатных действиях программы (по
умолчанию установлено данное значение);
warn: некритичные ошибки;
error: ошибки, приводящие к некорректным результатам;
fatal: критичные ошибки.
для отключения логирования sdk, установите значение off.
6.8.5.7 voicegrid processor
чтобы настроить voicegrid processor, выберите voice_grid в списке компонентов.
специфические параметры voicegrid processor настраиваются в секции sdk_voicegrid.
параметр описание
buffers_ports порты для потоковой передачи звука.
host имя или ip-адрес компьютера, на котором
установлен voicegrid processor.
max_connections_per_
port
максимальное количество подключений для
одного порта.
64 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
port_from начало диапазона.
port_inactivity_time
out
время в миллисекундах, после которого
неактивное подключение будет принудительно
закрыто.
port_to конец диапазона.
cache настройки кэша данных (см. cache в asr processor).
channel_type тип канала для обрабатываемого звука.
допустимые значения: unknown, mic, phone.
engines_count количество обработчиков.
profile профиль работы sdk.
допустимые значения: dnntvplda, ktvplda, tvplda, uni, vk_spoofing.
если значение профиля не указано, принимается профиль, установленный по
умолчанию.
при изменении профиля необходимо перезагрузить voicegrid processor.
sampling_rate частота дискретизации звука (в герцах).
speaker_split_algorithm алгоритм разделения дикторов в монофонограммах.
допустимые значения: cpd, polylog, dialog.
processor настройки процессора.
processor_type тип процессора.
возможные значения: cpu, gpu.
по умолчанию установлено cpu.
device_index индекс процессора.
применим только для gpu.
по умолчанию установлено 0.
threads настройки потоков.
model_builder настройка потоков для построения шаблонов.
capacity
количество потоков.
interval
максимальный период бездействия (в секундах).
preprocessor настройка потоков для вычисления количества
чистой речи.
capacity
количество потоков.
65 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
interval
максимальный период бездействия (в секундах).
6.8.5.8 voicekey processor
чтобы настроить voicekey processor, выберите voice_key в списке компонентов.
специфические параметры voicekey processor настраиваются в секции sdk_voicekey.
параметр описание
buffers_ports настройки портов для потоковой передачи звука.
host имя или ip-адрес компьютера, на котором
установлен voicekey processor.
max_connections_per_
port
максимально количество подключений для
одного порта.
port_from начало диапазона.
port_inactivity_timeo
ut
время в миллисекундах, после которого
неактивное подключение будет принудительно
закрыто.
port_to конец диапазона.
cache настройки кэша данных (см. cache в asr processor).
engines_count количество обработчиков.
sampling_rate частота дискретизации звука (в герцах).
6.8.5.9 kerberosproxy component
чтобы настроить kerberosproxy component, выберите kerberos_proxy в списке компонентов.
специфические параметры kerberosproxy component настраиваются в секции proxy.
параметр описание
kerberos настройки подключения к kdc (key distribution center).
keytab_file путь к keytab-файлу — файлу, содержащему пары
принципалов и ключей для них.
krb5_conf_file путь к файлу krb5.conf, содержащему настройки
подключения к kdc.
principal spn (service principal name — имя принципала службы),
используемое для kerberosproxy component.
location http-сервер, на который kerberosproxy component будет перенаправлять
http-запросы после прохождения kerberos-аутентификации.
66 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
6.8.5.10 loadbalancer component
чтобы настроить loadbalancer component, выберите load_balancer в списке компонентов.
специфические параметры loadbalancer component настраиваются в секции balancer.
параметр описание
asr настройки балансировки для asr processor.
cache_actualize_
interval_sec
интервал (в секундах) обновления информации о
загруженных пакетах на нодах asr processor.
по умолчанию: 5.
load_factor определяет количество нод asr processor для
загрузки пакета.
если для параметра load_factor установлено
значение 0.5, тогда загрузка пакета будет
осуществляться на половину нод asr processor.
по умолчанию: 0.5.
cache настройки управления балансировщиком кэшей шаблонов для facestc
processor и voicegrid processor.
model_presence_factor процент нод, в кэш которых будет загружен
шаблон.
по умолчанию: 0.3.
cache_pack_size максимальное количество шаблонов (пачки),
загружаемых за раз в процессор.
по умолчанию: 20.
group_loading настройки загрузки групп.
threads
количество потоков, загружающих одну группу из
database component.
по умолчанию: 2.
pack_size
размер пакета шаблонов, запрашиваемых у
database component одним потоком за раз.
по умолчанию: 100000.
node_alive_factor количество пропущенных ping от процессора, после которых процессор
считается отключённым.
по умолчанию: 3.
67 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
node_engines_load_factor параметр используется для расчёта уровня параллелизма при отправке запроса
идентификации на конкретную ноду. он определяет количество свободных
процессоров на ноде, которые можно задействовать при идентификации.
например, есть нода с 8 свободными процессорами. если для параметра
node_engines_load_factor установлено значение 0.75, то запрос на
идентификацию на эту ноду будет поделён на 6 (8 * 0.75) параллельных
подзапросов.
значение может быть из диапазона от 0 до 1.
если количество_свободных_движков * node_engines_load_factor
меньше 1, запрос отправляется без деления на части.
по умолчанию: 0.5.
vr настройки балансировки для voicerecognizer processor.
cache_actualize_inte
rval_sec
интервал (в секундах) обновления информации о
доступных моделях на нодах.
consider_models учитывать наличие моделей на нодах при
балансировке запросов.
6.8.5.11 mediastorage component
чтобы настроить mediastorage component, выберите media_storage в списке компонентов.
специфические параметры mediastorage component настраиваются в секциях:
– prune: настройка автоматического удаления файлов.
– tomcat: общие настройки сервера и массива с коннекторами (см. tomcat в configurator component).
– web_socket: параметры подключения по протоколу websocket.
параметры секции prune
параметр описание
is_enabled флаг, включающий/отключающий автоматическое удаление файлов.
life_time время жизни файлов (в часах).
0: время жизни не ограничено.
period частота запуска автоматического удаления (в секундах).
параметры секции web_socket
параметр описание
url адрес для подключения по протоколу websocket.
ws_chunk_limit размер блока передачи данных по протоколу websocket (в килобайтах).
6.8.5.12 voicerecognizer processor
чтобы настроить voicerecognizer processor, выберите voice_recognizer в списке компонентов.
68 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
специфические параметры voicerecognizer processor настраиваются в секциях transactions,
sdk_voicerecognizer и в секции result_logging.
параметры секции transactions
параметр описание
inactivity_timeout_ms время в миллисекундах, после которого неактивная сессия распознавания
будет принудительно закрыта.
eos_timeout_ms время тишины в миллисекундах по умолчанию, после которой произнесённая
речь будет считаться завершённой. применяется только в ivr-сценариях.
параметры секции result_logging
параметр описание
enabled включение/выключение логирования распознанного текста. по умолчанию
отключено.
параметры секции sdk_voicerecognizer
параметр описание
endpoint настройки подключения к сервису распознавания.
port порт сервиса распознавания.
host адрес сервиса распознавания.
timeouts sdk_response_timeout_
ms
максимальное время время ожидания ответа
от asr sdk (мс).
engines_count количество обработчиков.
6.8.5.13 vad processor
чтобы настроить vad processor, выберите vad в списке компонентов.
специфические параметры vad processor настраиваются в секциях transactions и sdk_vad.
параметры секции transactions
параметр описание
inactivity_timeout_ms время в миллисекундах, после которого неактивная сессия детектора речи
будет принудительно закрыта.
параметры секции sdk_vad
параметр описание
endpoint настройки подключения к сервису распознавания.
port порт сервиса распознавания.
host адрес сервиса распознавания.
69 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
timeouts sdk_response_timeout_
ms
максимальное время время ожидания ответа
от asr sdk (мс).
engines_count количество обработчиков.
6.8.5.14 texttransform processor
чтобы настроить texttransform processor, выберите text_transform в списке компонентов.
специфические параметры texttransform processor настраиваются в секции transactions и
sdk_text_transform.
параметры секции transactions
параметр описание
inactivity_timeout_ms время в миллисекундах, после которого неактивная сессия свёртки будет
принудительно закрыта.
параметры секции sdk_text_transform
параметр описание
endpoint настройки подключения к сервису распознавания.
port порт сервиса распознавания.
host адрес сервиса распознавания.
timeouts sdk_response_timeout_
ms
максимальное время время ожидания ответа
от asr sdk (мс).
engines_count количество обработчиков.
6.8.5.15 emo
чтобы настроить emo, выберите voicekey.emocloud в списке компонентов.
специфические параметры emo настраиваются в секции thresholds.
параметр описание
max_samples_in_one_messa
ge
максимальное количество выборок (samples) в одном сообщении.
по умолчанию установлено значение 480000 (1 мин 8 кгц звука).
установка 0 означает, что количество выборок не ограничено.
для настройки проверки доступности сервиса emo.sdk и его автоматического перезапуска при
необходимости, в списке компонентов выберите emo_stc. параметры настраиваются в секции sdk_emo.
параметр описание
grpc_server sdk_path путь к каталогу с установленным сервисом emo.sdk (в
случае пустой строки или указания на несуществующий
каталог, проверка доступности не производится).
70 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
health_timeout частота проверки доступности сервиса emo.sdk в
секундах (при значениях меньше или равном 0, проверка
доступности не производится).
6.8.5.16 mediahub component
чтобы настроить mediahub component, выберите media_hub в списке компонентов.
специфические параметры mediahub component настраиваются в секциях:
– sources: секция настроек подключений к серверам.
– tomcat: общие настройки сервера и массива с коннекторами (см. tomcat в configurator component).
– web_socket: параметры подключения по протоколу websocket.
– chat_navigator: параметры подключения к chatnavigator.
– external_api: секция настроек подключений url для обращения к mediahub.
– cloud_services: параметры подключения к сервисам google cloud и amazon.
параметры секции sources
параметр описание
aas настройки audio acquisition server
smartlogger настройки smartlogger ii
rtp настройки rtp.
параметры блока aas
параметр описание
ports host имя или ip-адрес хоста, к которому привязан
соответствующий tcp-сервер.
по умолчанию null: равен имени хоста, на
котором установлен mediahub component.
значение параметра необходимо изменить, если
на сервере имеется несколько сетевых
интерфейсов.
max_connections_per_
port
количество одновременных подключений на 1
порт.
port_from диапазон портов (от).
port_inactivity_time
out
время в миллисекундах, после которого
неактивное подключение будет принудительно
закрыто.
port_to диапазон портов (до).
71 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметры блока smartlogger
параметр описание
ports host имя или ip-адрес хоста, к которому привязан
соответствующий tcp-сервер.
по умолчанию null: равен имени хоста, на
котором установлен mediahub component.
значение параметра необходимо изменить, если
на сервере имеется несколько сетевых
интерфейсов.
max_connections_per_
port
количество одновременных подключений на 1
порт.
port_from начало диапазона.
port_inactivity_time
out
время в миллисекундах, после которого
неактивное подключение будет принудительно
закрыто.
port_to конец диапазона.
receiver_host имя хоста, к которому подключается smartlogger ii для передачи звука.
по умолчанию null: будет взято имя хоста, на котором установлен mediahub
component.
параметры блока rtp
параметр описание
ports host имя или ip-адрес хоста.
по умолчанию null: равен имени хоста, на
котором установлен mediahub component.
max_connections_per_
port
количество одновременных подключений на 1
порт.
port_from диапазон портов (от).
port_inactivity_time
out
время в миллисекундах, после которого
неактивное подключение будет принудительно
закрыто.
port_to диапазон портов (до).
параметры секции web_socket
параметр описание
url адрес для подключения по протоколу websocket.
72 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
ws_chunk_limit_kb размер блока передачи данных по протоколу websocket (в килобайтах).
параметры секции chat_navigator
параметр описание
http_client_connect_time
out
настройка клиента при отправке запроса в chatnavigator, время жизни tcp-
соединения.
http_client_read_timeout настройка клиента при отправке запроса в chatnavigator, время ожидания
чтения сокета клиента.
параметры секции external_api
параметр описание
url aдрес сервера, на котором работает mediahub component. используется
для генерации поля replyto (для получения ответа от chatnavigator). если
адрес указан, то результат: url+\"/rest\"+'адрес конкретного эндпоинта для
выбранного api. если не указан, то можно получить адрес текущего хоста с
портом из настроек \"tomcat\".
параметры секции cloud_services
параметр описание
google_cloud настройки подключения к сервисам google cloud.
amazon_web_services настройки подключения к сервисам amazon.
параметры блока google_cloud
параметр описание
proxy port номер порта прокси-сервера, используемого при
подключении к сервисам google.
host имя или ip-адрес прокси-сервера, используемого
при подключении к сервисам google.
credentials реквизиты сервисного аккаунта в формате json. подробнее о создании
сервисного аккаунта на сайте google identity:
https://developers.google.com/identity/protocols/oauth2/service-account?
hl=en#creatinganaccount.
параметры блока amazon_web_services
параметр описание
73 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
proxy port номер порта прокси-сервера, используемого при
подключении к сервисам amazon.
host имя или ip-адрес прокси-сервера, используемого
при подключении к сервисам amazon.
recognizer_region custom_region местоположение центра обработки и передачи
данных в свободной форме.
region выбор из списка местоположения центра
обработки и передачи данных. значения можно
посмотреть по ссылке amazon transcribe streaming.
synthesizer_region custom_region местоположение центра обработки и передачи
данных в свободной форме.
region выбор из списка местоположения центра
обработки и передачи данных. значения можно
посмотреть по ссылке amazon transcribe streaming.
credentials access_key_id идентификатор ключа доступа к сервисам amazon.
secret_access_key ключ доступа к сервисам amazon.
6.8.6 индивидуальные настройки экземпляров
вкладка серверы имеет обратную структуру относительно вкладки компоненты и содержит секции,
каждая из которых соответствует серверу, входящему в состав комплекса.
внутри каждой секции отображаются экземпляры компонентов, которые установлены на
соответствующие серверы.
каждый сервер в раскрывающемся списке отображается с индикатором состояния.
рисунок 5 — сервер
для индивидуальной настройки экземпляра на сервере перейдите компоненты>
<название_компонента>> xxx.xx.x.xx и разверните настраиваемый параметр, например:
74 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
рисунок 6 — секция asr_defaults для индивидуальной настройки сервера
кнопка g служит для заполнения поля данного параметра значением из глобальных настроек.
кнопка c служит для переопределения настроек компонента данного параметра.
кнопка служит для очистки введённой в поле информации.
кнопка служит для возврата настроек к последним сохранённым значениям.
внесите необходимые изменения и нажмите кнопку сохранить.
6.8.7 настройка учётных данных configurator component
для изменения учётных данных и добавления новых пользователей для использования
пользовательского интерфейса configurator component выберите configurator в списке
компонентов.
в секции configurator_users можно добавить, изменить или удалить пользователя, в том числе
configadmin.
6.9 запуск компонентов
после изменения конфигурации запустите компоненты в следующем порядке:
1. configurator component;
2. router component;
3. security component.
запустите остальные компоненты:
systemctl start {component_name}
# пример systemctl start vk_configuratorcomponent
для запуска всех компонентов в правильном порядке с небольшой задержкой возможно
использовать скрипт, например:
#!/bin/sh
echo "starting vk_configuratorcomponent"
systemctl start vk_configuratorcomponent
75 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
sleep 20
echo "starting vk_routercomponent"
systemctl start vk_routercomponent
sleep 20
echo "starting vk_securitycomponent"
systemctl start vk_securitycomponent
sleep 20
for n in $(ls /opt/ | grep vk| grep -v -e '(configurator)|(router)|(security)'); do systemctl
start $n ;
echo "starting $n"
done
запустите tomcat с помощью команды:
systemctl start tomcat
для проверки состояния компонента можно использовать команду вида:
systemctl status <название_компонента>
например:
systemctl status vk_configuratorcomponent
если компонент запущен, в ответ будет получено: "active: active (running)".
для проверки состояния всех компонентов возможно использовать скрипт.
например, скрипт vkcomponents.sh:
#!/bin/sh
for n in $(ls /opt/ | grep vk); do systemctl $1 $n ; done
после создания скрипта необходимо сделать его исполняемым:
chmod +x vkcomponents.sh
затем выполнить:
sh vkcomponents.sh status
для остановки всех компонентов выполните команду:
sh vkcomponents.sh stop
для остановки одного компонента выполните команду:
systemctl stop <название_компонента>
для остановки компонентов, использующих компоненты asr sdk 9, необходимо дополнительно
выполнить одну из следующих команд:
1. для компонента voicerecognizer processor:
systemctl stop microkernelservice
2. для компонента texttransform processor:
systemctl stop microkerneltransformservice
3. для компонента vad processor:
systemctl stop vadservice
6.10 настройка kerberosproxy component
в данном разделе описывается настройка аутентификации пользователей с помощью kerberosproxy
component.
важными требованиями к конфигурации kerberosproxy component являются:
76 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
– kerberosproxy component должен быть представлен в области kerberos через принципала
kerberos.
– kerberosproxy component должен иметь возможность доступа к kdc (key distribution center).
– kerberosproxy component должен иметь доступ к учётным данным своей учётной записи в
kerberos.
6.10.1 создание учётной записи в ad
для работы kerberosproxy component необходимо создать пользователя в active directory
(ad), который содержит имя участника службы (spn — service principal name) kerberos.
основное имя: <name>@<realm_name>, где:
<name>: имя пользователя;
<realm_name>: административное имя области.
далее в инструкции настройки kerberosproxy component используется пример пользователя с
основным именем usersurname.vktest.local@vktest.local. компьютер, на котором размещается
kerberosproxy component должен быть частью домена vktest.local. тип учётной записи в ad —
пользователь (не компьютер).
создание пользователя
чтобы создать пользователя usersurname.vktest.local в ad для kerberosproxy component:
1. запустите оснастку programs/administrative tools/active directory users and
computers.
2. правой кнопкой мыши нажмите на узел users и выберите new/user (не выбирайте machine).
3. в поля full name и logon name введите пользователя usersurname.vktest.local. нажмите
next.
4. введите пароль.
5. убедитесь, что ни один из параметров пароля не установлен. нажмите next.
6. нажмите finish.
настройка пользователя
после создания пользователя:
1. дважды щёлкните на имени пользователя usersurname.vktest.local в дереве пользователей в
левой панели.
2. на вкладке account для пользователя usersurname.vktest.local убедитесь, что при
использовании шифра:
– aes128-sha — выбрана опция this account supports aes 128 bit encryption; все остальные
(кроме срока действия пароля) сняты.
– aes256-sha1 — выбрана опция this account supports aes 256 bit encryption; все остальные
(кроме срока действия пароля) сняты.
– rc4-hmac-nt — все опции (кроме срока действия пароля) сняты.
– des-cbc-crc — выбрана опция use kerberos des encryption types for this account; все
остальные (кроме срока действия пароля) сняты.
77 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
3. нажмите ок.
6.10.2 генерация keytab-файла
определите spn и создайте keytab для kerberosproxy component
spn (имя участника службы) — это уникальное имя, которое идентифицирует экземпляр
kerberosproxy component и связано с учётной записью входа, под которой kerberosproxy component
подключается к ad. spn используется в процессе взаимной аутентификации между клиентом и
kerberosproxy component. клиент находит учётную запись на основе spn, к которой он пытается
подключиться.
средство командной строки ktpass позволяет администратору настроить службу kerberos,
отличную от windows server, в качестве принципала в windows server active directory.
ktpass настраивает имя участника сервера для службы в active directory и создаёт файл
server.keytab в стиле mit, содержащий общий секретный ключ службы. этот инструмент позволяет
службам на основе unix, которые поддерживают проверку подлинности kerberos, использовать
функции взаимодействия, предоставляемые службой windows server kerberos kdc.
в командной строке windows выполните следующие команды для настройки имени участника службы
(при использовании шифра aes256) и создания файла keytab:
1. проверка наличия зарезервированных spn:
setspn -l vktest\usersurname.vktest.local
вывод команды:
registered serviceprincipalnames for cn=usersurname.vktest.local,cn=users,dc=vktest,dc=local:
2. резервирование spn usersurname.vktest.local для пользователя
usersurname.vktest.local:
setspn -a http/usersurname.vktest.local vktest\usersurname.vktest.local
вывод команды:
checking domain dc=vktest,dc=local
registering serviceprincipalnames for cn=usersurname.vktest.local,cn=users,dc=vktest,dc=local
http/usersurname.vktest.local
updated object
3. проверка резервирования spn для пользователя usersurname.vktest.local:
setspn -l vktest\usersurname.vktest.local
вывод команды:
registered serviceprincipalnames for cn=usersurname.vktest.local,cn=users,dc=vktest,dc=local:
http/usersurname.vktest.local
4. генерация keytab файла:
ktpass -princ http/usersurname.vktest.local@vktest.local -mapuser vktest\usersurname.vktest.local
-pass "some_password" -crypto aes256-sha1 -ptype krb5_nt_principal -out c:\server.keytab
вывод команды:
targeting domain controller: vkkerbad.vktest.local
successfully mapped http/usersurname.vktest.local to kerberos.
password successfully set!
key created.
key created.
key created.
78 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
key created.
key created.
output keytab to c:\server.keytab:
keytab version: 0x502
keysize 88 http/usersurname.vktest.local@vktest.local ptype 1 (krb5_nt_principal) vno 3 etype
0x12 (aes256-sha1) keylength 32
(0x09bff99762c7b6418487dc56e8cca20e9a6378ca1a0a155a576d915957f4cdfc)
6.10.3 конфигурация kerberosproxy component
создание krb5.conf файла
необходимо создать файл krb5.conf, содержание которого аналогично следующему:
[logging]
default = file:/var/log/krb5libs.log
kdc = file:/var/log/krb5kdc.log
admin_server = file:/var/log/kadmind.log
[libdefaults]
dns_lookup_realm = false
ticket_lifetime = 24h
renew_lifetime = 7d
forwardable = true
rdns = false
pkinit_anchors = /etc/pki/tls/certs/ca-bundle.crt
default_ccache_name = keyring:persistent:%{uid}
default_realm = vktest.local
default_tkt_enctypes = aes256-cts-hmac-sha1-96
default_tgs_enctypes = aes256-cts-hmac-sha1-96
permitted_enctypes = aes256-cts-hmac-sha1-96
[realms]
vktest.local = {
kdc = vkkerbad.vktest.local
}
[domain_realm]
vktest.local = vktest.local
.vktest.local = vktest.local
важно:
– присвоить default_tkt_enctypes, default_tgs_enctypes и permitted_enctypes согласно
выбранному алгоритму шифрования.
– указать default_realm.
перенос конфигурационных файлов
скопируйте krb5.conf и keytab файл в /opt/vk_kerberosproxy/kerberos.
смените владельца и группу на vkplatform.
включение отладки kerberos в kerberosproxy component
для отладки клиента kerberos в kerberosproxy component:
добавьте параметр -dsun.security.krb5.debug=true в строке запуска jsvc в
файле /opt/vk_kerberosproxy/bin/service.sh.
перезапустите kerberosproxy component.
проверка доступных алгоритмов ciphertest
чтобы проверить доступные алгоритмы ciphertest, введите следующую команду:
79 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
java -classpath /opt/vk_kerberosproxy/biometric-platform-kerberos-proxy-component-{version}.jar
com.speechpro.biometric.platform.component.kerberos.ciphertest
вывод команды:
max allowed key length: 2147483647
built in etype defaults:
18
17
16
23
в таблице ниже представлено соответствие etype типу алгоритма шифрования:
тип алгоритма etype
des-ede3-cbc-env-oid 15
des3-cbc-sha1-kd 16
aes128-cts-hmac-sha1-
96
17
aes256-cts-hmac-sha1-
96
18
rc4-hmac 23
rc4-hmac-exp 24
для поддержки aes256-cts-hmac-sha1-96 для oracle java 1.8 необходимо установить библиотеку
java cryptography extension. вместо oracle java 1.8 возможно использование openjdk 1.8.
настройка kerberosproxy component в configurator component
настройка параметров kerberosproxy component в веб-интерфейсе configurator component
приводится в пункте kerberosproxy component подраздела индивидуальные настройки компонентов.
6.10.4 устранение неполадок
в таблице ниже приведены возможные ошибки, возникающие при настройке kerberosproxy
component, их описание и способы устранения.
код текст ошибки описание
401 active directory user not registered in
security database, sid: s-1-5-21-2006880441-
3870697321-2598461747-35882
пользователь заведён в ad, но
не добавлен в группы
vk_allusers и группу,
сопоставленную с должностью
(например
vk_inspectoruser).
401 см. логи:
org.ietf.jgss.gssexception: defective token
detected (mechanism level: gssheader did not
find the right tag)
браузер настроен некорректно
и не передаёт spnego токен.
401 см. логи:
javax.security.auth.login.loginexception:
unable to obtain password from user
kerberosproxy component
пытается работать с kdc при
80 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
код текст ошибки описание
помощи пароля принципала.
необходимо проверить
наличие в указанной
директории krb5.conf и
keytab файла.
убедитесь, что keytab выписан
на правильный realm, и ключ,
используемый в keytab
совместим с вашей java -
ciphertest.
403 user 'vk_user' is blocked пользователь заблокирован, так
как удалён из группы
vk_allusers.
81 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
6.11 security component: работа с веб-интерфейсом
для работы с биометрическими данными необходимо создать пользователей и указать доступные им
действия.
для перехода к пользовательскому интерфейсу укажите в адресной строке браузера следующий
адрес:
https://<host>:<port>/, где:
– <host>: имя или ip-адрес сервера, на котором установлен voicekey portal.
– <port>: порт для подключения к voicekey portal (индивидуально для каждой установки комплекса,
см. раздел установка voicekey portal документа voicekey.platform руководство по установке и
настройке).
авторизуйтесь на портале, нажав на кнопку авторизоваться и заполнив авторизационные данные.
рисунок 7 — авторизация на портале
в списке приложений выберите security.
82 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
рисунок 8— внешний вид веб-интерфейса security component
блок настройки содержит в себе вкладки настроек элементов структуры прав.
блок директории содержит директории.
в блоке сессии в зависимости от настроенных привилегий отображаются открытые сессии
пользователей домена (для всех пользователей кроме root) или всех пользователей (для пользователя
root).
блок ключи содержит список пользователей и доступных для них api-ключей. в данном блоке api-
ключи можно создавать, блокировать, удалять, редактировать их описание.
— кнопка смены языка интерфейса. в выпадающем меню выберите язык интерфейса.
— кнопка перехода к настройкам и выхода из портала.
— кнопка перехода к документации.
6.11.1 структура разграничения прав доступа
работа пользователей с системой и биометрическими данными основана на использовании учётных
записей, которым присвоен набор должностей.
для каждой должности назначается набор ролей. один пользователь может иметь несколько
должностей (например, оператор, администратор).
все элементы структуры прав и ресурсы в виде данных существуют в рамках домена.
все привилегии, выданные пользователю, дают права на действия внутри домена. например,
привилегия на регистрацию должности (registerpositionprivilege = security.) разрешает пользователю
регистрировать должности только в домене, указанном при создании пользователя.
правами на действия внутри всех доменов обладает суперпользователь: логин root, пароль по умолчанию
123456as!, домен root domain.
83 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
после первоначальной установки рекомендуется сменить пароль и переподключиться.
6.11.2 управление пользователями
для работы с данными пользователей откройте вкладку пользователи. в правой части экрана
отображается список пользователей.
для просмотра должностей пользователя нажмите кнопку .
для создания пользователя нажмите создать пользователя.
заполните поля. поля, обязательные для заполнения, отмечены . список должностей появляется
при выборе домена.
нажмите создать.
логин и пароль чувствительны к регистру.
для редактирования найдите созданного пользователя в списке и нажмите .
в открывшемся окне при необходимости отредактируйте данные пользователя. для одного
пользователя можно установить неограниченное число должностей в рамках одного домена, указанного
при создании пользователя.
после внесения всех изменений нажмите обновить.
при нажатии кнопки отмена произойдёт возврат на главную страницу без сохранения
произведённых изменений.
в рамках одного домена имя пользователя должно быть уникальным.
для удаления пользователя найдите его в списке и нажмите кнопку .
для блокировки пользователя найдите его в списке и нажмите кнопку . имя пользователя станет
зачёркнутым. данный пользователь больше не сможет войти в систему.
для разблокировки пользователя нажмите кнопку .
6.11.3 управление должностями
для работы с данными должностей откройте вкладку должности. в правой части экрана
отображается список должностей.
для просмотра назначенных ролей на должность нажмите кнопку .
для создания должности нажмите создать должность, заполните поле имя и укажите домен,
выберите роли (роли появляются после выбора домена).
для редактирования должности найдите ее в списке и нажмите кнопку . в открывшемся окне
установите роли для данной должности и отредактируйте имя должности при необходимости. для одной
должности можно установить неограниченное число ролей в рамках одного домена, указанного при
создании должности. после внесения всех изменений нажмите обновить. при нажатии кнопки отмена
произойдёт возврат на главную страницу без сохранения произведённых изменений.
84 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
в рамках одного домена имя должности должно быть уникальным.
для удаления должности найдите её в списке и нажмите кнопку .
6.11.4 управление ролями
для работы с данными ролей откройте вкладку роли. в правой части экрана отображается список
ролей.
чтобы отобразить привилегии нажмите кнопку .
для создания роли нажмите создать роль, заполните поле имя, выберите домен и добавьте
привилегии. при добавлении привилегий воспользуйтесь фильтрами компоненты и поиск.
чтобы отсортировать привилегии по компонентами, используйте фильтр компоненты. нажмите и
в списке компонентов выберите интересующий. в области ниже отобразятся доступные для компонента
привилегии. установите галочки напротив тех привилегий, которые будут добавлены в список
привилегий роли. или установите галочку напротив названия компонента, тогда все привилегии
добавятся в список привилегий роли.
для поиска по словам в названии привилегии воспользуйтесь фильтром поиск. начните набирать в
поле фильтра слова из названия привилегии, в области ниже отобразится список привилегий, названия
которых, содержат данные слова.
рисунок 9 — создание роли
для редактирования роли найдите её в списке и нажмите кнопку . в открывшемся окне укажите
привилегии для данной роли и отредактируйте её имя при необходимости. для одной роли можно
установить неограниченное число привилегий и меток в рамках одного домена, указанного при
85 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
создании роли. после внесения всех изменений нажмите обновить. при нажатии кнопки отмена
произойдёт возврат на главную страницу без сохранения произведённых изменений.
в рамках одного домена имя роли должно быть уникальным.
для удаления роли найдите её в списке и нажмите кнопку .
6.11.5 привилегии
при первом запуске все компоненты комплекса регистрируют доступные привилегии в security
component. для просмотра привилегий откройте вкладку привилегии и разверните список
интересующего компонента с помощью кнопки . привилегии создаются автоматически и их
редактирование невозможно.
список всех привилегий представлен в таблице ниже.
компонент наименование
database component
database. привилегия на создание бкш
database. привилегия на чтение бкш персоны
database. привилегия на обновление бкш
database. привилегия на удаление бкш
database. привилегия на создание персоны
database. привилегия на чтение персоны
database. привилегия на обновление персоны
database. привилегия на удаление персоны
database. привилегия на чтение группы
database. привилегия на регистрацию группы
database. привилегия на удаление группы
database. привилегия на обновление группы
database. привилегия на добавление персон в группу
facestc processor
facestc. привилегия на получение результата проверки живого пользователя
facestc. привилегия на получение результата проверки качества
изображения
facestc. привилегия на создание бкш facestc
facestc. привилегия на сравнение шаблонов facestc
86 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
компонент наименование
facestc. привилегия на чтение метаданных бкш
facestc. привилегия на определение границ фронтального фото лица
faceaccess application
faceaccess. привилегия на работу с приложением
mediagallery application
mediagallery. привилегия на чтение персон
mediagallery. привилегия на создание персон
mediagallery. привилегия на удаление персон
mediagallery. привилегия на удаление файлов
mediagallery. привилегия на создание файлов
mediagallery. привилегия на чтение файлов
security component
security. привилегия на чтение домена
security. привилегия на регистрацию пользователя
security. привилегия на чтение пользователей
security. привилегия на блокировку пользователя
security. привилегия на разблокировку пользователя
security. привилегия на удаление пользователя
security. привилегия на изменение пароля пользователя
security. привилегия на чтение компонентов
security. привилегия на чтение должностей
security. привилегия на регистрацию должности
security. привилегия на обновление должности
security. привилегия на удаление должности
security. привилегия на регистрацию ролей
security. привилегия на чтение ролей
security. привилегия на обновление ролей
87 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
компонент наименование
security. привилегия на удаление роли
security. привилегия на чтение всех сессий
security. привилегия на закрытие сессии по идентификатору
security. привилегия на блокировку api ключа
security. привилегия на разблокировку api ключа
security. привилегия на обновление данных api ключа
security. привилегия на чтение данных api ключа
security. привилегия на удаление api ключа
security. привилегия на создание api ключа
security. привилегия на настройку директорий пользователей
security. привилегия на чтение истории изменений объектов
security. привилегия на создание меток
security. привилегия на удаление меток
security. привилегия на чтение меток
security. привилегия на чтение всех ресурсов конкретного типа
security. привилегия на чтение типов ресурсов
security. привилегия на обновление ресурсов
security. привилегия на чтение доступных пользователю ресурсов
security. привилегия на проверку доступности ресурса
voicegrid processor
voicegrid. привилегия на сравнение шаблонов
voicegrid. привилегия на создание бкш
voicegrid. привилегия на обогащение бкш
voicegrid. привилегия на идентификацию шаблона
voicekey processor
voicekey. привилегия на сравнение шаблонов
voicekey. привилегия на создание liveness detection feature
88 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
компонент наименование
voicekey. привилегия на создание бкш
voicekey. привилегия на обогащение бкш
voicekey. привилегия на чтение метаданных бкш
voicekey. привилегия на получение результата проверки качества звука
asr processor
asr. привилегия на распознавание звука
tts processor
tts. привилегия на получение списков доступных языков и голосов
tts. привилегия на синтез речи в режиме реального времени
tts. привилегия на синтез речи в отложенном режиме
reporter component
reporter. привилегия на обновление шаблона отчёта
reporter. привилегия на создание расписания
reporter. привилегия на просмотр шаблона отчёта
reporter. привилегия на удаление отчёта
reporter. привилегия на просмотр отчёта
reporter. привилегия на создание шаблона отчёта
reporter. привилегия на создание отчёта
reporter. привилегия на удаление шаблона отчёта
smevadapter application
smevadapter. привилегия на чтение дополнительных полей пользователя
smevadapter. привилегия на управление дополнительными полями
пользователей
smevadapter. привилегия на чтение центров обслуживания
smevadapter. привилегия на управление центрами обслуживания
smevadapter. привилегия на чтение журнала операций
smevadapter. привилегия на отправку запросов в смэв
smevadapter. привилегия на создание документов
smevadapter. привилегия на управление биометрическими образцами
mediastorage component
mediastorage. привилегия на создание типа файла
mediastorage. привилегия на обновление файла
mediastorage. привилегия на удаление файла
89 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
компонент наименование
mediastorage. привилегия на создание файла
mediastorage. привилегия на чтение файла
buzzer application
buzzer. привилегия на управление кампаниями
siphon application
siphon. привилегия на управление звонками
vad processor
vad. привилегия на определение наличия речи и её расположения на
звуковом отрезке в отложенном режиме
vad. привилегия на получение списка доступных моделей
vad. привилегия на определение наличия речи и её расположения на
звуковом отрезке в реальном времени
texttransform processor
texttransform. привилегия на получение результата преобразования в
реальном времени
texttransform. привилегия на получение результата преобразования в
отложенном режиме
texttransform. привилегия на получение списка доступных моделей
voicerecognizer processor
voicerecognizer. привилегия на получение списка доступных моделей
voicerecognizer. привилегия на распознавание речи в текст в реальном
времени
voicerecognizer. привилегия на распознавание речи в текст в отложенном
режиме
emo processor
emo. привилегия на возможность определения эмоций
emo. привилегия на получение списка доступных моделей
voiceliveness application
voiceliveness. привилегия на работу с приложением
offlinerecognizer application
offlinerecognizer. привилегия на работу с приложением
mediaprobe component
mediaprobe. привилегия на управление источниками
chatnavigator создание выборок
90 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
компонент наименование
просмотр диагностической информации по диалогу
выгрузка отчётов "одуванчик"
выгрузка диалогов
выгрузка отчётов "оценка пользователей"
выгрузка отчётов "популярность тем"
выгрузка отчётов "количество вопросов"
выгрузка отчётов "качество ответов"
выгрузка отчётов "качество диалогов"
выгрузка отчётов "топ 100 тем"
выгрузка отчётов "статистика"
редактирование новых тем
управление каналами
настройка приоритета каналов
текстовый редактор
визуальный редактор
разметка шагов диалога
оценка сессии
просмотр всех каналов
просмотр журнала событий
просмотр отчета автоматизация
просмотр каналов
просмотр отчёта "одуванчик"
просмотр отчёта
просмотр новых тем и диалогов
просмотр сценария диалога
просмотр отчёта "оценка пользователей"
просмотр проверка целостности
просмотр выборок
просмотр отчёта "популярность тем"
91 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
компонент наименование
просмотр отчёта "количество вопросов"
просмотр состояние компонентов
просмотр отчёта "качество ответов"
просмотр отчёта "качество диалогов"
просмотр отчёта "топ 100 тем"
просмотр отчёта "статистика"
редактирование сценария диалога
назначение пользователей на каналы
6.11.6 управление доменами
для пользователя на вкладке домены отображается его текущий домен.
рисунок 10 — вкладка домены для пользователя
пользователь не сможет создать, изменить или удалить домен, если у него нет на это привилегий. для
управления доменами авторизуйтесь в подсистеме разграничения прав доступа с помощью учётной записи
суперпользователя root.
рисунок 11 — вкладка домены для суперпользователя
для создания домена нажмите кнопку создать домен и заполните поле имя.
92 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
для редактирования имени найдите домен в списке доменов и нажмите кнопку . в открывшемся
окне отредактируйте имя. после внесения изменений нажмите обновить. при нажатии кнопки отмена
произойдёт возврат на главную страницу без сохранения произведённых изменений.
имя домена должно быть уникальным.
для удаления домена найдите его в списке и нажмите кнопку .
6.11.7 управления ключами
для каждого пользователя можно создать api-ключ. ключ можно использовать вместо связки
логин+пароль+домен для создания сессии.
для работы с api-ключами откройте вкладку ключи. в правой части экрана отображается список
пользователей.
если для пользователя создан api-ключ, нажмите кнопку . для редактирования ключа нажмите
кнопку . для удаления — .
для создания ключа выберите пользователя в списке и нажмите кнопку . введите описание и
укажите срок действия ключа. если ключ создается на определённое время, снимите флаг бессрочно и
укажите дату окончания срока действия ключа. нажмите сохранить.
6.12 security component: настройка интеграции с ldap
в security component пользователи могут создаваться либо локально (см. раздел security
component: работа с веб-интерфейсом) через веб-интерфейс security component, либо при помощи
механизма интеграции с ad.
за работу данного механизма отвечают директории пользователей.
в данный момент реализовано два типа директорий:
– database: пользователи и структура прав хранятся в базе данных security component.
– ldap: security component синхронизирует пользователей и структуру должностей с ldap.
пользователи заводятся в security component автоматически, если администратор ldap добавляет
их в необходимые группы. таким же образом происходит управление ролями пользователя.
6.12.1 создание учётной записи ad
для интеграции security component и active directory необходимо создать учетную запись в active
directory:
1. запустите оснастку programs/administrative tools/active directory users and
computers/.
2. правой кнопкой мыши нажмите на узел users и выберите new/user (не выбирайте machine).
3. введите пользователя bind в поля full name и logon name.
4. нажмите next и введите пароль.
93 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
5. снимите галочку user must change password at next login и выберите галочку password never
expires.
6. нажмите finish.
6.12.2 настройка подключения к ad
перейдите в веб-интерфейс configurator component по адресу http://<host>:<port>/configurator/,
где <host> — имя вашего сервера, а <port> — порт для подключения к voicekey portal.
подробнее о настройке с помощью configurator component см. в разделе веб-интерфейс configurator
component.
параметры и их описание для настройки security component приведены в пункте security component
подраздела индивидуальные настройки компонентов.
чтобы настроить подключение к active directory:
1. в списке компонентов слева выберите security.
2. разверните секцию настроек user_directories в конце списка.
3. разверните блок настроек ldap_directory> ldap_connection.
4. настройте следующие параметры:
параметр описание
url url, используемый для подключения к серверу ldap.
рекомендуется использовать протокол ldaps (см. настройка ssl ).
bind_dn dn пользователя, из-под которого security component подключается к
active directory.
bind_password пароль данного пользователя.
6.12.3 настройка ssl
при использовании протокола ldaps для работы с сервером active directory возможны следующие
варианты:
1. сертификат ad подписан доверенным центром сертификации; имя хоста совпадает с именем в
сертификате.
2. cамоподписанный сертификат ad; имя хоста совпадает с именем в сертификате.
3. самоподписанный сертификат или подписанный доверенным центром сертификации; имя хоста
не совпадает с именем в сертификате.
использование самоподписанных сертификатов (пункт 2 и 3 из списка выше) не обеспечивает
необходимого уровня безопасности при работе по протоколу ldaps.
настоятельно рекомендуется использовать сертификат ad, подписанный доверенным центром
сертификации с именем хоста, совпадающим с именем в сертификате (пункт 1).
94 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
вариант 1: доверенный сертификат
если сертификат ad подписан доверенным центром сертификации и имя хоста совпадает с именем в
сертификате, дополнительные настройки ssl не требуются — достаточно указать ldaps в качестве
используемого протокола. для этого:
1. перейдите в веб-интерфейс security component и выберите security в списке компонентов
слева.
2. разверните блок настроек user_directories> ldap_directory> ldap_connection.
3. в поле url укажите url, используемый для подключения к серверу по протоколу ldaps
(ldaps://).
вариант 2: самоподписанный сертификат
важно помнить, что данный вариант не обеспечивает необходимого уровня безопасности.
чтобы самоподписанный сертификат работал, его необходимо импортировать в глобальный или
локальный keystore.
импорт в глобальный keystore
если ключ импортируется в глобальный кейстор, достаточно указать ldaps в качестве используемого
протокола.
для этого:
1. перейдите в веб-интерфейс security component и выберите security в списке компонентов
слева.
2. разверните блок настроек user_directories> ldap_directory> ldap_connection.
3. в поле url укажите url, используемый для подключения к серверу по протоколу ldaps
(ldaps://).
для импорта ключа в глобальный keystore выполните команды:
1. получение сертификата с сервера ad:
# echo "" | openssl s_client -connect vkkerbad.vktest.local:636 -showcerts 2>/dev/null | openssl
x509 -out certfile.txt
2. проверка имеющихся сертификатов:
# keytool -keystore /usr/lib/jvm/java-8-oracle/jre/lib/security/cacerts -storepass changeit -list
3. импорт сертификата в локальный или глобальный keystore:
# keytool -import -storepass changeit -alias vkkerbad_vktest_local -keystore /usr/lib/jvm/java-8-
oracle/jre/lib/security/cacerts -trustcacerts -file ./certfile.txt
импорт в локальный keystore
для импорта в локальный keystore выполните команды:
1. создание директории для ключей:
# mkdir /opt/keys
# cd /opt/keys
2. получение сертификата с сервера ad:
# echo "" | openssl s_client -connect vkkerbad.vktest.local:636 -showcerts 2>/dev/null | openssl
x509 -out certfile.txt
95 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
vkkerbad.vktest.local: сервер ad
636: tcp-порт, через который осуществляется передача данных ldaps
certfile.txt: название файла с сертификатом на выходе
3. создание keystore и импорт ключа:
# keytool -import -storepass changeit -alias vkkerbad_vktest_local -keystore /opt/keys/cacerts -
trustcacerts -file ./certfile.txt
vkkerbad_vktest_local: уникальный псевдоним (alias) для сертификата в keystore
перейдите в веб-интерфейс security component и выберите security в списке компонентов слева.
разверните блок настроек user_directories> ldap_directory> ldap_connection и настройте параметры:
параметр значение
use_ssl true
cred_source keystore
keystore_settings keystore_path file:/opt/keys/cacerts
указание file: в пути к keystore обязательно
вариант 3: имя хоста отличается от указанного в сертификате
важно помнить, что данный вариант не обеспечивает необходимого уровня безопасности.
при использовании данного варианта необходимо отключить проверку сертификата на стороне
security component. чтобы отключить проверку сертификата:
1. перейдите в веб-интерфейс configurator component и выберите security в списке
компонентов слева.
2. разверните блок настроек user_directories> ldap_directory> ldap_connection> ssl.
3. настройте параметры:
параметр значение
allow_any_certificate true
allow_any_hostname true
cred_source none
6.12.4 настройка автоматической синхронизации
для автоматической синхронизации active directory и security component необходимо сопоставить
группы ad и должности security component.
далее в качестве примера для настройки синхронизации используется сценарий
voicekey.inspector.
настройка выполняется в 3 этапа:
1. создание необходимых групп и добавление в них пользователей ad.
2. создание структуры прав, необходимой для работы сценария.
96 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
3. сопоставление должностей security component и групп ad; запуск синхронизации.
также возможен режим, в котором ad используется только для аутентификации. пользователи
создаются вручную и добавляются в необходимые должности в voicekey.platform, но используют для
входа доменный пароль.
при использовании такого режима не нужно настраивать сопоставление должностей с группами ad.
создание ролей для сценария voicekey.inspector
имя назначение необходимые привилегии
vk_inspectoradmin создание цо
сопоставление
пользователей с цо
readusersprivilege
readuserpropertiesprivilege
readservicecenterprivilege
userpropertiesmanagementprivilege
servicecentermanagementprivileg
vk_inspectoraudit просмотр журнала
отправление запросов в
смэв
экспорт статистики по
регистрации бо
readusersprivilege
readuserpropertiesprivilege
readservicecenterprivilege
readoperationprivilege
vk_inspectoruser сбор и отправка бо readusersprivilege
smevrequestsprivilege
documentprivilege
getqualitymetricsprivilege
findfaceborderprivilege
getqualitymetricsprivilege
создание должностей
после создания ролей их необходимо присвоить указанным должностям.
должность роль
vk_inspectoruser vk_inspectoruser
vk_inspectoradmin vk_inspectoradmin
vk_inspectoraudit vk_inspectoraudit
настройка схемы
настройки схемы позволяют использовать security component различные реализации ldap-
серверов.
по умолчанию параметры схемы настроены для использования ad.
для настройки схемы перейдите в configurator component и выберите security в списке
компонентов слева.
параметры блока schema
разверните блок user_directories> ldap_directory> schema и настройте параметры:
параметр значение описание
97 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
additional_group_dn cn=groups имя контейнера со всеми группами ad.
additional_user_dn cn=users имя контейнера со всеми пользователями ad.
all_users_group_dn cn=vk_allusers имя группы, содержащей всех пользователей.
при использовании автоматической
синхронизации пользователей указание
группы обязательно.
base_dn dc=vktest,dc=local базовый dn.
параметры блока group_schema
при необходимости настройте блок параметров группы: user_directories> ldap_directory>
schema> group_schema:
параметр значение описание
group_object_filter (&(objectclass=group)
(cn=*))
фильтр по группам.
возможно указать cn=vk_* вместо cn=* для
вывода групп, содержащих префикс vk_.
параметры блока user_schema
при необходимости настройте блок параметров пользователя: user_directories> ldap_directory>
schema> user_schema.
параметр значение описание
user_auth_filter (&(objectclass=user)
(samaccountname={user}))
фильтр ldap, используемый для
аутентификации пользователя.
user_display_name_attrib
ute
displayname имя атрибута пользователя, используемое при
загрузке фио (отображаемого имени).
user_email_attribute имя атрибута, используемое при загрузке
почтового адреса.
user_first_name_attribut
e
имя атрибута пользователя, используемое при
загрузке имени.
user_last_name_attribute имя атрибута пользователя, используемое при
загрузке фамилии.
user_name_attribute имя атрибута пользователя, используемое при
загрузке имени пользователя.
параметры блока synchronization
настройте блок синхронизации: user_directories> ldap_directory> synchronization:
параметр описание
enable включение/выключение автоматической синхронизации.
98 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
interval интервал синхронизации (в миллисекундах).
сопоставление групп ad с должностями
сопоставление имеет приоритет над ручным редактированием должности в веб-интерфейсe security
component. необходимо иметь в виду, что:
– если выполнено сопоставление и пользователь директории ldap в нем отсутствует, он будет
удалён из должности.
– при удалении, пока пользователь есть в группе ad, он будет добавляться в должность.
– параметры пользователя, выставленные в ldap, имеют больший приоритет.
чтобы сопоставить должности с уже созданными в ad группами, перейдите в веб-интерфейс security
component, расположенный по адресу http://<host>:8086/security/, где <host> — имя вашего сервера.
подробнее о работе с веб-интерфейсом security component см. в разделе security component: работа с
веб-интерфейсом.
в меню слева выберите директории> - ldap.
нажмите создать новое соответствие.
выберите должность и ldap-группу, из которых будет сформировано соответствие, и нажмите
создать.
пример сопоставления для сценария voicekey.inspector:
группа ldap должность
cn=vk_inspectoradmin,cn=groups,dc=vktest,dc=local vk_inspectoradmin
cn=vk_inspectoraudit,cn=groups,dc=vktest,dc=local vk_inspectoraudit
cn=vk_inspectorusers,cn=groups,dc=vktest,dc=local vk_inspectoruser
после создания соответствий нажмите синхронизировать. также вы можете настроить
автоматическую синхронизацию через веб-интерфейс configurator component.
миграция пользователей
возможно осуществить миграцию пользователей из одной директории в другую с помощью формы
редактирования пользователя. для этого:
выберите одну из доступных директорий (ldap или database).
при необходимости можно указать тип директории при помощи sql-команды:
update "clientgeneral"."users" set directory=3;
доступные директории:
2 — пароли хранятся в базе данных;
3 — аутентификация через ldap.
6.12.5 управление пользователями
добавление пользователя ad в должность
добавьте пользователя в группу сn=vk_allusers,cn=groups,dc=vktest,dc=local.
99 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
затем добавьте пользователя в группу
сn=vk_inspectorusers,cn=groups,dc=vktest,dc=local.
пользователь будет создан автоматически при следующей синхронизации.
удаление пользователя из должности
удалите пользователя из группы сn=vk_inspectorusers,cn=groups,dc=vktest,dc=local.
пользователь будет убран из должности автоматически при следующей синхронизации.
блокировка пользователя в voicekey.platform
удалите пользователя из группы сn=vk_allusers,cn=groups,dc=vktest,dc=local.
пользователь будет заблокирован в платформе автоматически, при следующей синхронизации.
разблокировка пользователя
для активации достаточно снова добавить пользователя в vk_allusers, при следующей
синхронизации он будет активирован, ему будут присвоены необходимые должности согласно членству в
группах.
6.13 mediastorage component: работа с веб-интерфейсом
mediastorage component используется для хранения бинарных данных различных форматов.
mediastorage component обеспечивает хранение фонограмм, расшифровок и метаданных, относящихся
к вызовам, а также хранение биометрических данных клиентов (фотографии, аудиозаписи, метаданные).
mediastorage component позволяет искать и извлекать данные по http для внешних систем и по
внутреннему api платформы.
для перехода к пользовательскому интерфейсу укажите в адресной строке браузера следующий
адрес:
https://<host>:<port>/, где:
– <host>: имя или ip-адрес сервера, на котором установлен voicekey portal.
– <port>: порт для подключения к voicekey portal (индивидуально для каждой установки комплекса,
см. раздел установка voicekey portal документа voicekey.platform руководство по установке и
настройке).
авторизуйтесь на портале, нажав на кнопку авторизоваться и заполнив авторизационные данные.
100 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
рисунок 12 — авторизация на портале
в списке приложений выберите mediastorage.
рисунок 13— внешний вид пользовательского интерфейса mediastorage component
блок поиск используется для поиска, редактирования, скачивания и удаления файлов.
101 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
блок загрузка используется для загрузки новых файлов.
блок настройки используется для регистрации типов файлов.
— кнопка смены языка интерфейса. в выпадающем меню выберите язык интерфейса.
— кнопка перехода к настройкам и выхода из портала.
— кнопка перехода к документации.
настройки портала
в выпадающем списке с именем пользователя (на рисунке ) выберите настройки.
в открывшемся окне укажите число загружаемых файлов и максимальный размер файла. для
mediastorage component настройка увеличение рамки изображения не применяется.
рисунок 14— настройки портала
6.13.1 загрузка файлов
загрузка новых файлов в mediastorage component производится в блоке загрузка
пользовательского интерфейса. как правило, используются основные типы: picture, sound, unknown.
другие типы файлов необходимо зарегистрировать (см. регистрация новых типов файлов). файлы могут
быть загружены как по одному, так и несколько файлов за раз. максимальный размер одного файла (по
умолчанию): 5 мбайт. чтобы изменить это значение перейдите в настройки портала.
для загрузки файла в mediastorage component:
1. нажмите загрузить и выберите в проводнике необходимые файлы. загруженные файлы
отобразятся в поле справа.
102 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
2. установите параметры загружаемого файла (если загружено несколько файлов, параметры будут
применены сразу ко всем):
– время удаления: время, через которое файл будет автоматически удалён из базы данных nosql
(mongodb).
не ограничено: автоматическое удаление файла не предусмотрено; файл может быть удалён только
вручную (см. управление файлами).
по умолчанию: это значение указано в конфигураторе в параметре life_time секции prune.
выберите и укажите период (час, день, месяц, квартал, год), по истечении которого файл удалится
автоматически.
– тип: в выпадающем списке измените тип файла (при необходимости). как правило, тип файла
определяется автоматически после загрузки выбранных файлов (шаг 1). по завершению загрузки к
созданному автоматически имени файла (когда имя файла не было указано) добавляется префикс,
соответствующий выбранному типу. при этом расширение файла удаляется. например, для типа
sound имя файла будет sound_<сгенерированное_имя_файла>.
– метаданные: могут быть в виде array, value, object. чтобы указать для файла необходимые
метаданные, нажмите и выберите тип метаданных. ниже появятся поля для заполнения. введите
название и значение метаданных, например: person_id: 122.
3. при необходимости измените параметры конкретного загружаемого файла. для этого в поле
справа на иконке выбранного файла нажмите . в открывшемся окне произведите необходимые
изменения и нажмите ок. при изменении времени удаления, типа или метаданных для
конкретного файла будет отображаться соответствующий изменению значок. чтобы изменить имя
файла, в поле на иконке файла введите новое имя. после загрузки имя файла изменить
невозможно. файл можно удалить, нажав на иконке файла.
4. нажмите кнопку сохранить. файлы будут загружены в базу данных nosql (mongodb).
рисунок 15 — интерфейс блока загрузка
103 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
при попытке загрузить файл с именем, которое уже существует в базе данных, отобразится
сообщение с предупреждением. чтобы заменить существующий файл на новый с таким же именем,
нажмите «да», чтобы оставить список файлов без изменений, нажмите «нет». установите флажок напротив
строки «применить для всех совпадений имён файлов», чтобы действие повторилось при загрузке для
следующих файлов.
рисунок 16 — сообщение с предупреждением о замене файла
6.13.2 управление файлами
доступные операции с файлами в блоке поиск:
– поиск;
– просмотр;
– скачивание;
– замена;
– редактирование данных файла;
– удаление.
поиск файлов
для поиска файлов в mediastorage component используются два режима: поиск по id и поиск по
параметрам файла.
результат поиска отображается в виде таблицы и карточки файла, в которых содержится вся
информация о файле: идентификатор, версия, имя, тип, дата создания и обновления, время удаления,
метаданные.
104 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
рисунок 17 — результат поиска файлов в mediastorage
режим поиска id используется для поиска файла, идентификатор которого известен пользователю.
результатом поиска является единичный файл.
чтобы выполнить поиск в режиме id:
1. введите идентификатор в поле введите id файла;
2. нажмите начать поиск.
при условии, что введён верный идентификатор файла, система выдаст результат как на рисунке 17.
если введённый идентификатор не существует, система выдаст сообщение не найдено ни одного файла.
режим поиска параметры является расширенным, выполняется при помощи операторов and, or,
not и like, equal, in, between, greater, less. поиск в данном режиме позволяет уточнить поисковый запрос,
результатом которого является релевантный файл или группа файлов.
чтобы выполнить поиск в режиме параметры:
1. выберите логический оператор: and, or, not.
2. выберите параметр поиска: дата обновления, дата создания, имя, метаданные, тип.
3. для поиска по параметру метаданные необходимо дополнительно выбрать формат метаданных:
string, date, number, bool.
4. выберите оператор, соответствующий выбранному параметру: like, equal, in, between, greater, less.
5. укажите искомое значение параметра.
для поиска по имени:
– при выборе оператора equal необходимо ввести точное название искомого файла. в противном
случае поиск не будет выполнен.
– при выборе оператора like в качестве значения укажите неполное имя файла, используя знаки "%"
для поиска по части слова и "_" для замены части имени на любой знак. например, чтобы найти все
файлы, в названии которых встречается слово клиент, в поле значения введите %клиент%.
– при использовании операторов between, greater, less необходимо указать цифру или букву, с
которой начинается имя файла. поиск будет выполнен относительно введённого знака.
105 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
– при использовании оператора in укажите несколько значений, которые должны содержаться в
имени искомого файла.
для поиска по типу оператор in позволяет выбрать в выпадающем списке сразу несколько типов
искомых файлов.
6. при необходимости добавьте дополнительные параметры поиска и повторите шаги 1–5.
7. нажмите начать поиск.
если все значения параметров поиска введены верно, система выдаст результат в виде таблицы (см.
рис. 18). в случае, если не удалось найти файл, соответствующий параметрам поиска, система выдаст
сообщение не найдено ни одного файла.
рисунок 18 — результат поиска файлов в режиме параметры
редактирование данных файла
редактирование данных файла включает в себя:
– изменение типа файла;
– изменение времени, через которое файл будет удалён из базы данных nosql (mongodb);
– добавление, изменение и удаление метаданных.
остальные данные файла (версия, id, имя, дата создания, дата обновления) задаются автоматически и
не могут быть отредактированы.
чтобы отредактировать данные файла, в карточке файла нажмите кнопку редактировать данные.
доступные для изменения данные отобразятся в виде выпадающих списков и полей для заполнения.
после внесения необходимых изменений, нажмите сохранить. данные будут обновлены. в таблице в
колонке дата обновления отобразится дата и время редактирования.
106 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
замена файла
замена файла производится на файл в аналогичном формате. для замены нажмите заменить файл, в
проводнике выберите расположение нового файла. после загрузки в карточке файла обновится версия.
имя файла остаётся неизменным.
удаление файла
для удаления медиафайла в таблице нажмите кнопку . файл будет удалён из базы данных.
при удалении фотографии или аудиозаписи голоса клиента из mediastorage component, его
биометрический шаблон при этом остаётся. чтобы удалить биометрический шаблон клиента
вместе с его биометрическими медиаданными, на портале voicekey portal перейдите во вкладку
person и удалите профиль клиента.
6.13.3 регистрация новых типов файлов
регистрация новых типов файлов, загружаемых в mediastorage component производится в блоке
настройки.
рисунок 19 — интерфейс блока настройки
все поля этого блока обязательны для заполнения, чтобы зарегистрировать тип файла, отличный от
типов по умолчанию: sound, picture, unknown.
поле имя типа — название типа файлов.
например: txt.
поле имя файла по умолчанию — префикс к автоматически созданному имени файла.
например: txt_f1458da3-0338-4938-ada8-81f95e5556da_2021_01_13-14_30_837.
поле расширение — расширение файла, относящееся к данному типу.
например: txt.
107 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
после заполнения всех полей нажмите зарегистрировать. списки типов файлов обновятся в
mediastorage component.
6.14 установка и настройка audio acquisition server
компонент audio acquisition server поставляется на отдельном дистрибутивном диске и
устанавливается на сервере записи телефонных вызовов, работающем под управлением ос windows.
для установки компонента запустите файл audioserver.msi из дистрибутива. следуя указаниям
программы установки, выполните следующие действия:
1. примите условия лицензионного соглашения;
2. при необходимости измените каталог установки компонента;
3. дождитесь завершения установки.
по окончании установки будет отображена программа настройки компонента (рис. 20).
ниже приведено описание параметров настройки и возможных значений.
в дальнейшем запуск программы настройки осуществляется из меню пуск:
пуск > все программы > speech technology center > voicekey > audioserver configurator.
рисунок 20 — программа настройки компонента audio acquisition server
параметр описание
подключение к rabbitmq группа настроек подключения к серверу rabbitmq, установленному в
составе voicekey.platform.
необходимо ввести те же параметры, которые были указаны при
установке rabbitmq.
хост название компьютера, на котором установлен rabbitmq.
порт порт для подключения к rabbitmq.
виртуальный хост виртуальный хост rabbitmq.
108 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
параметр описание
пользователь пользователь rabbitmq.
пароль пароль пользователя rabbitmq.
источник звука группа настроек подключения к источнику звуковых данных.
дорожка выберите, из какой звуковой дорожки следует получать звук для
верификации клиента: левой или правой.
имя источника введите имя источника (программного компонента), установленного на
данном компьютере для записи речевых сообщений. поддерживается
работа со следующими источниками системы smartlogger ii:
sip, avayadmccsource, sbsource, parrot, rtp, siemenstrading,
avayaipofficesource, bks, alcateldectsource, sapbcmsource, cisco.
путь логирования звука путь к каталогу, в который будут сохраняться записи поступающего звука.
записи звука могут занимать много дискового пространства, поэтому
данную возможность следует использовать только в целях отладки.
чтобы звук не сохранялся на диске, оставьте поле пустым.
линии чтобы указать телефонные линии для мониторинга, выделите поле
линии и нажмите кнопку .
в появившемся окне нажмите кнопку добавить.
введите номер телефона (канала записи) для мониторинга в поле
номер телефона.
аналогичным образом добавьте все интересующие номера в список и
нажмите ок.
url сервиса задайте адрес, по которому другие компоненты комплекса смогут
получать доступ к информации об активных вызовах.
contactcenterid
после завершения настройки нажмите кнопку сохранить.
109 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
6.15 reporter component: работа с веб-интерфейсом
для перехода к пользовательскому интерфейсу укажите в адресной строке браузера следующий
адрес:
https://<host>:<port>/, где:
– <host>: имя или ip-адрес сервера, на котором установлен voicekey portal.
– <port>: порт для подключения к voicekey portal (индивидуально для каждой установки комплекса,
см. раздел установка voicekey portal документа voicekey.platform руководство по установке и
настройке).
авторизуйтесь на портале, нажав на кнопку авторизоваться и заполнив авторизационные данные.
рисунок 21 — авторизация на портале
в списке приложений выберите reporter.
110 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
рисунок 22— внешний вид пользовательского интерфейса reporter component
функции основных элементов интерфейса voicekey portal:
— кнопка смены языка интерфейса. в выпадающем меню выберите язык интерфейса.
— кнопка перехода к настройкам и выхода из портала.
— кнопка перехода к документации.
работа с компонентом формирования отчётности осуществляется в три этапа:
– управление шаблонами;
– управление отчётами;
– управление планировщиком (расписание генерации отчётов).
6.15.1 подготовка к запуску
перед запуском reporter component необходимо создать пользователя подсистемы отчётности в
базе данных — учётную запись на sql-сервере, а также добавить в базу данных шаблоны отчётов,
входящие в поставку. для этого выполните следующие действия:
1. для создания табличного пространства и пользователя reporter_user, который имеет доступ к
этому пространству, выполните скрипт oracle-create-reporter-user-tablespace.sql под
пользователем system.
2. для создания пользователя reporter_user для входа в веб-интерфейс компонента отчётности
воспользуйтесь веб-интерфейсом security component (см. security component: работа с веб-
интерфейсом ).
3. подключитесь к базе данных под пользователем reporter_user.
111 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
4. выполните скрипт создания таблиц подсистемы отчётности oracle-create-reporter-
tables.sql и сохраните изменения. если этот скрипт выполнялся ранее на этапе настройки
oracle database, повторный запуск не требуется.
5. выполните скрипты добавления шаблонов для соответствующей бд:
– для oracle database:
oracle-insert-agent-templates.sql
oracle-insert-general-agent-templates.sql
– для postgresql:
postgres-insert-agent-templates.sql
postgres-insert-general-agent-templates.sql
6. сохраните изменения.
7. через общий конфигуратор настройте секцию application для reporter component (см.
reporter component ).
8. запустите службу reporter component.
6.15.2 управление шаблонами
шаблон представляет собой общее описание структуры отчёта. шаблон содержит sql-запрос,
генерирующий отчёт — выборку из логов системы, а также описание, позволяющее пользователю при
создании отчёта задавать параметры запроса (фильтрация по значениям того или иного столбца), и
просматривать данные отчёта в человекочитаемом формате. также по шаблону можно настроить
расписание генерации отчётов.
6.15.2.1 создание шаблона
для создания шаблона перейдите во вкладку шаблоны веб-интерфейса reporter component и
нажмите добавить. в правой части формы (рис. 23) заполните следующие поля:
1. имя шаблона в человекочитаемом формате. это имя будет уникальным идентификатором шаблона.
2. sql-запрос, формирующий выборку в базе данных, с указанием параметров. названия параметров
могут быть любыми.
некоторые параметры можно сделать необязательными. для этого название параметра должно точно
повторять название поля в бд.
пример:
select * from books where book_name = :book_name and book_number = :nomer
в этом случае параметр book_name может быть необязательным, а параметр nomer — должен быть
обязательным.
функция не поддерживается в следующих случаях:
– для одного столбца предусмотрено больше одного именованного параметра
пример:
select * from test_table where some_date between :start_date and :end_date
если в этом случае не задать значения параметров, то при генерации отчёта произойдёт
ошибка.
– значения указанного столбца проверяются на неравенство параметру (операции >, <, <>, !=,
^=)
112 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
пример:
select * from test_table where id > :id
если в этом случае не задать значение параметра, то ошибки не произойдёт, но
сгенерированный отчёт будет пустым.
3. параметры
для каждого параметра необходимо заполнить следующие поля:
– имя параметра в отчете (в человекочитаемом формате) — имя, которое будет показано
пользователю при создании отчёта по этому шаблону. рекомендуется давать параметру такое
имя, чтобы пользователю, создающему отчёт, было понятно какие данные требуется ввести.
– имя параметра в базе данных.
– тип данных, соответствующий данному параметру (number, string, datetime, boolean,
date). необходимо для того, чтобы при создании отчёта пользователь ввёл данные в
корректном формате.
– тестовое значение — значение параметра, которое будет подставляться в запрос при
проверке шаблона на достоверность. для необязательных параметров это поле можно не
заполнять.
– является ли этот параметр обязательным. любой параметр можно сделать обязательным, но в
некоторых случаях необязательность параметра приведёт к некорректному созданию отчёта.
– будет ли возможность подставить несколько значений для одного параметра (если параметр в
sql-запросе является частью конструкции in).
4. в блоке результат добавьте описание столбцов таблицы, которая будет создана в базе данных в
результате выполнения sql-запроса.
для каждого столбца нужно задать следующие поля:
– имя колонки в отчете (в человекочитаемом формате) — имя, которое будет использовано в
представлении отчёта в виде таблицы (в интерфейсе и в файле);
– имя колонки в базе данных;
– тип данных колонки (выбрать из списка).
при заполнении этих полей важно следить за тем, что их порядок и названия (поле имя колонки в
базе данных) точно соответствуют столбцам выборки, сформированной указанным sql-запросом.
5. визуализация отчёта.
отчёт может быть представлен в разных формах: круговой график, гистограмма, линейный график.
чтобы задать вид готовому отчёту, необходимо заполнить следующие поля:
– имя графика (в человекочитаемом формате).
– тип графика: круговой (pie), линейный (line), гистограмма (bar).
– x: значения, отображаемые на оси х (выбрать из списка).
– y: значения, отображаемые на оси y (выбрать из списка).
113 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
рисунок 23 — создание шаблона
нажмите кнопку сохранить. на сервере осуществляется попытка создать тестовую таблицу по sql-
запросу с использованием указанных тестовых значений в качестве параметров. если не происходит
никаких ошибок, шаблон сохраняется и становится доступным для создания по нему отчётов и настройки
расписаний в планировщике.
6.15.2.2 редактирование и удаление шаблона
для редактирования выберите шаблон из списка и, аналогично созданию шаблона, задайте новые
значения нужных полей и нажмите сохранить. после редактирования получившийся шаблон будет
также протестирован и сохранён в случае отсутствия ошибок.
отчёты, созданные по старой версии шаблона, останутся доступными для просмотра.
если по данному шаблону было настроено расписание создания отчётов в планировщике, будет
произведена проверка на соответствие параметров, указанных в новом шаблоне, и параметров в
расписании. если обнаружены расхождения, то пользователь получит предупреждение, а расписание
станет неактивным до тех пор, пока параметры не будут приведены в соответствие.
для удаления шаблона нажмите справа от его названия в списке. расписания по этому шаблону
остановят свою работу и станут недоступными.
6.15.3 настройка отчётов
отчёт — таблица, сформированная в базе данных на основе описания, предоставленного в шаблоне.
6.15.3.1 создание отчёта
для создания отчёта перейдите во вкладку отчёты и нажмите добавить.
для начала введите имя отчёта, выберите шаблон и укажите количество дней до удаления отчёта. по
истечении этого срока отчёт будет автоматически удалён из базы данных.
114 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
далее задайте необходимые параметры. для некоторых типов значений вместо ввода параметра
можно выбрать «тег», который представляет собой заранее определённое значение. существует тег
текущее время для параметров начало периода и окончание периода.
рисунок 24 — создание отчёта
после создания отчёт отображается на экране в виде таблицы и появляется в списке слева. если в
результате выполнения запроса получено пустое множество, то будет отображено сообщение «данных
для отчета, удовлетворяющих параметрам sql запроса, не найдено». при выгрузке такого отчёта, в нём
отображается только шапка таблицы. если в шаблоне заданы параметры визуализации, то отчёт будет
представлен в том виде, который указан в шаблоне. для просмотра графика выберите график на
переключателе над таблицей.
115 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
рисунок 25 — пример графика по отчёту
полученный отчёт также можно экспортировать в файл. для этого нажмите экспортировать и в
выпадающем списке выберите желаемый формат: csv, xls, xlsx, json.
все созданные за последнюю неделю отчёты перечислены в списке слева. список можно
сортировать по дате создания и имени шаблона, а также осуществлять поиск по имени шаблона и
запрашивать отчёты, созданные за конкретный период.
для удаления отчёта нажмите справа от его названия в списке. отчёт будет удалён из базы данных.
6.15.4 настройка расписания
в системе предусмотрена возможность создания отчетов по шаблону в соответствии с заданным
расписанием.
6.15.4.1 создание расписания
для создания расписания перейдите во вкладку расписание, нажмите добавить и заполните поля:
– имя расписания;
– имя шаблона, по которому будет строиться отчёт;
– количество дней до удаления.
задайте значения параметров (см. создание отчёта).
укажите данные для автоматической генерации отчётов:
– дата следующего создания;
– период генерации: день, неделя, месяц, квартал, год, другой (в днях);
116 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
– частота генерации (количество дней, по которым будет генерироваться отчёт в указанный
период);
– дата последнего создания.
укажите адрес и формат сохранения отчёта (если эти поля не заполнить, то отчёт будет сохранён
только в базе данных):
– имя директории для отчётов, созданных по данному расписанию;
– расширение файла (csv, xls, xlsx, json).
в результате созданные отчёты будут иметь полное имя следующего вида:
/<отчёты>/<имя_конечной_директории>/имя_шаблона_дата_создания.<расширение>, где
<отчёты> — путь к директории с отчётами, указанный в конфигурации,
<имя_конечной_директории>, <расширение> — значения полей, заданные в интерфейсе.
117 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
рисунок 26 — создание расписания
нажмите кнопку сохранить. в результате созданное расписание появляется в списке слева и будет
иметь кнопки и для запуска генерации отчёта и удаления отчёта соответственно.
118 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
для поиска расписания введите полное название расписания в поле имя и/или выберите статус
расписания.
при запуске нового расписания в указанную дату первой генерации планировщик формирует отчёт и
сохраняет его в базу данных. если указано имя и тип файла, производится экспорт в файл на сервере.
после этого отчёты продолжат генерироваться с указанным периодом. если в качестве даты первой
генерации был указан сегодняшний день, то отчёт будет создан немедленно.
все последующие генерации будут происходить в нужный день в 00:00:00. данные за этот день не
будут отражены в отчёте.
при необходимости ежемесячной генерации отчёта настройте расписание на первое число
каждого месяца.
запущенное расписание можно приостановить. отчёты перестанут создаваться до тех пор, пока
расписание не будет вновь запущено.
если запуск расписания произошёл после предполагаемой даты следующей генерации, то
следующая генерация произойдёт с сохранением периода. например, расписание, создающее отчёт
каждую неделю, впервые было запущено в среду, а затем приостановлено на несколько недель. при
запуске этого расписания в понедельник новый отчёт будет создан только в среду и продолжит
создаваться по средам.
если расписание имеет статус не соответствует шаблону, это значит, что при редактировании
шаблона были внесены изменения в набор параметров, и параметры, введённые при создании этого
расписания, теперь не соответствуют шаблону. когда расписание приобретает статус не соответствует
шаблону, генерация отчётов по нему приостанавливается. для возобновления работы расписания
приведите параметры в соответствие, отредактировав расписание или его шаблон.
6.15.4.2 редактирование расписания
любое расписание можно отредактировать. для этого нажмите на расписание, внесите необходимые
изменения и сохраните их. после редактирования расписание продолжает работу в прежнем режиме
(статус сохраняется).
при указании нового периода генерации будет предложено изменить дату следующей генерации.
если дата изменена, расписание продолжит работу, начиная с указанной даты.
если расписание оказалось неактивным после изменения шаблона, после приведения параметров в
соответствие расписание приобретёт статус, который оно имело до того, как стало недействительным.
6.16 протоколирование работы
расположение лог-файлов по умолчанию:
1. основные лог-файлы компонентов находятся в папке /var/log/voicekey/имя_сервиса/. структура
расположения лог-файлов представлена ниже:
├── chroniclercomponent
│ ├── chronicler_intver.log
│ ├── chronicler.log
│ ├── vk_chroniclercomponent.err.log
│ └── vk_chroniclercomponent.out.log
├── configuratorcomponent
│ ├── configurator_intver.log
│ ├── configurator.log
│ ├── configurator_tomcat.log
│ ├── storage
119 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
│ │ └── tasks
│ ├── vk_configuratorcomponent.err.log
│ ├── vk_configuratorcomponent.err.log~
│ ├── vk_configuratorcomponent.out.log
│ └── vk_configuratorcomponent.out.log~
├── databasecomponent
│ ├── database_intver.log
│ ├── database.log
│ ├── vk_databasecomponent.err.log
│ └── vk_databasecomponent.out.log
├── facestc processor
│ ├── facesdk_3.8.645
│ │ └── main__2018_05_21_08_31_24__3435.log
│ ├── facestc_intver.log
│ ├── facestc.log
│ ├── vk_facestc processor.err.log
│ └── vk_facestc processor.out.log
├── licensingcomponent
│ ├── licensing_intver.log
│ ├── licensing.log
│ ├── licensing_tomcat.log
│ ├── vk_licensingcomponent.err.log
│ └── vk_licensingcomponent.out.log
├── routercomponent
│ ├── router_intver.log
│ ├── router.log
│ ├── vk_routercomponent.err.log
│ └── vk_routercomponent.out.log
├── securitycomponent
│ ├── security_intver.log
│ ├── security.log
│ ├── security_ormlite.log
│ ├── security_tomcat.log
│ ├── vk_securitycomponent.err.log
│ └── vk_securitycomponent.out.log
├── storage
└── voicekeyprocessor
├── vk_voicekeyprocessor.err.log
├── vk_voicekeyprocessor.out.log
├── voicekey_intver.log
└── voicekey.log
2. лог-файлы сторонних сервисов, которые используются в работе комплекса voicekey.platform,
находятся в следующих папках:
сервис расположение лог-файлов
apache tomcat /var/log/tomcat/
rabbitmq /var/log/rabbitmq/
веб-сервер nginx /var/log/nginx/
mongodb /var/log/mongodb
6.17 monitoring component: метрики
в менеджере мониторинга существует 2 типа метрик: пользовательские и системные.
системные метрики отображают информацию о памяти и потоках в рамках jvm.
системные метрики:
120 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
метрика описание единица измерения
метрики компонентов
integrity_verifier_count контроль целостности
компонента
0(ok) - 1(fail)
component_state состояние компонента 1(up) - 0(down)
метрики потоков
thread_count количество потоков шт.
peak_thread_count пиковое количество потоков шт.
метрики памяти
max_heap_memory максимальное количество heap
memory
мбайт
used_heap_memory используемое количество heap
memory
мбайт
initial_heap_memory начальное количество heap
memory
мбайт
max_non_heap_memory максимальное количество non
heap memory
мбайт
used_non_heap_memory используемое количество non
heap memory
мбайт
initial_non_heap_memory начальное количество non heap
memory
мбайт
метрики сборщиков мусора (garbage collectors)
gc_collection_time время затраченное на сборку
мусора.
нарастающим итогом по каждому
сборщику.
мс
gc_collection_count количество произошедших
сборок мусора.
нарастающим итогом по каждому
сборщику.
шт.
121 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
пользовательские метрики реализовываются индивидуально для каждого компонента и отображают
информацию о полезных для данного компонента показателях.
пользовательские метрики:
компонент метрика описание единица
измерения
asr processor
graphsсache access_time длительность получения
графа из кэша
мс
building_time длительность добавления
графа в кэш
мс
downloading_time длительность загрузки
графа из файла
мс
loading_errors количество ошибок
загрузки графов
шт.
access_errors количество ошибок
получения графов из кэша
шт.
building_errors количество ошибок
добавления графа в кэш
шт.
download_errors количество ошибок
загрузки графа из файла
шт.
graphs_count количество графов в кэше шт.
graphs_loaded количество загрузок
графов
шт.
packagecache package_loading длительность загрузки
пакета
мс
packages_count количество загруженных
пакетов
шт.
loading_errors количество ошибок при
загрузке пакетов
шт.
packages_loaded количество загрузок
пакетов
шт.
availablememorymanager total_memory количество памяти
доступное для пакетов
мбайт
used_memory количество памяти
используемое для
пакетов
мбайт
122 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
available_memory количество памяти
доступное для пакетов
мбайт
allocation_failed количество ошибок
выделения памяти для
пакета
шт.
offlinerecognizerservice processing_duration длительность
распознавания
мс
samples_duration длительность аудиофайла мс
recognition_errors количество ошибок при
распознавании
шт.
recognition_rtl соотношение
длительности аудио к
длительности
распознавания
вещественное
число
onlinerecognizerservice stream_finishing длительность завершения
транзакции
распознавания
мс
recognition_errors количество ошибок во
время транзакции
распознавания
шт.
non_recognition_time время затраченное на
операции не
участвующие в
распознавании
мс
transaction_duration длительность транзакции
распознавания
мс
recognition_rtl соотношение
длительности аудио к
длительности
распознавания
вещественное
число
recognizerenginepool created_engines количество созданных
движков
шт.
available_engines количество доступных
движков
шт.
total_engines количество движков шт.
offline_engines количество оффлайн
движков
шт.
online_engines количество онлайн
движков
шт.
123 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
tts processor
voicescache voices количество доступных
голосов
шт.
languages количество доступных
языков
шт.
ttsengine symbols количество обработанных
символов
шт.
duration длительность операции
синтеза
мс
errors количество ошибок во
время операции синтеза
шт.
ttsresulthandler sound_length размер результата
синтеза
байт
text_length количество
синтезированных
символов
шт.
telemetryawareprocessinghandler duration длительность обработки
запросов
мс
invocations количество запросов шт.
ttsenginepool created_engines количество созданных
движков
шт.
available_engines количество доступных
движков
шт.
total_engines количество движков шт.
overhead количество запросов
превышающее доступное
количество движков
шт.
wait_time время ожидания
доступного движка
мс
ttstransactioncontroller buffer_transactions количество транзакций шт.
web_socket_transactio
ns
количество транзакций
по websocket
шт.
created_transactions количество созданных
транзакций
шт.
ttstransaction request_size количество символов в
запросе
шт.
124 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
processing_time длительность обработки
транзакции
мс
transaction_duration длительность транзакции мс
synthesizetransactionwebsocket socket_duration длительность транзакции мс
request_size количество символов в
запросе
шт.
sockets_count количество открытых
сокетов
шт.
created_sockets_count количество открытий
сокетов
шт.
socket_errors количество ошибок
сокета
шт.
mediahub component
factory instances_count количество созданных
фабрик (процессоров,
источников, задач)
шт.
sampleprocessor count количество
обработанного звука
байт
duration длительность работы
процессора
мс
textprocessor count количество обработанных
символов
шт.
duration длительность работы
процессора
мс
frameprocessor count количество обработанных
фреймов
шт.
duration длительность работы
процессора
мс
websocketsource web_socket_source_co
unt
количество источников
websocket
шт.
active_text_sockets
active_frame_sockets
active_sample_sockets
количество активных
соединений через
websocket
соответствующего типа
(text, frame, sample)
шт.
created_text_sockets
created_frame_sockets
количество созданных
соединений через
websocket
шт.
125 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
created_sample_socket
s
соответствующего типа
(text, frame, sample)
нарастающим итогом
closed_text_sockets
closed_frame_sockets
closed_sample_sockets
количество закрытых
соединений через
websocket
соответствующего типа
(text, frame, sample)
нарастающим итогом
шт.
text_socket_errors
frame_socket_errors
sample_socket_errors
количество ошибок
websocket в соединениях
соответствующего типа
(text, frame, sample)
нарастающим итогом
шт.
voicerecognizer processor
asrserviceengine errors количество полученных
ошибок sdk
шт.
transactionopenhandler
transactionbufferopenhandler
transactionclosehandler
transactionrecognizesamplehandler
transactionrestartrecognitionhandler
transactionstatehandler
transactionstreamopenhandler
duration длительность обработки
запросов
мс
invocations количество запросов шт.
asrserviceenginepool created_engines количество созданных
движков
шт.
available_engines количество доступных
движков
шт.
total_engines количество движков шт.
acquired_engines количество используемых
движков
шт.
overhead количество запросов
превышающее доступное
количество движков
шт.
wait_time время ожидания
доступного движка
мс
126 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
buffertransaction
dummytransaction
streamtransaction
transaction_duration длительность транзакции мс
transactions_count количество транзакций шт.
request_size размер запроса
(длительность аудио)
мс
processing_duration длительность обработки
транзакции
мс
processing_rtl соотношение размера
запроса к длительности
обработки
вещественное
число
processing_rtf соотношение
длительности обработки к
размеру запроса
вещественное
число
vad processor
vadengine errors количество полученных
ошибок sdk
шт.
getmarkupsamplehandler
getmodelslisthandler
transactionbufferopenhandler
transactionclosehandler
transactiongetmarkupsamplehandler
transactionstatehandler
duration длительность обработки
запросов
мс
invocations количество запросов шт.
vadenginepool created_engines количество созданных
движков
шт.
available_engines количество доступных
движков
шт.
total_engines количество движков шт.
acquired_engines количество используемых
движков
шт.
overhead количество запросов
превышающее доступное
количество движков
шт.
wait_time время ожидания
доступного движка
мс
buffertransaction
dummytransaction
transaction_duration длительность транзакции мс
transactions_count количество транзакций шт.
request_size размер запроса
(длительность аудио)
мс
127 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
processing_duration длительность обработки
транзакции
мс
processing_rtl соотношение размера
запроса к длительности
обработки
вещественное
число
processing_rtf соотношение
длительности обработки к
размеру запроса
вещественное
число
texttransform processor
texttransformengine errors количество полученных
ошибок sdk
шт.
getmodelslisthandler
gettextsamplehandler
transactionbufferopenhandler
transactionclosehandler
transactiongettexthandler
transactionstatehandler
duration длительность обработки
запросов
мс
invocations количество запросов шт.
texttransformenginepool created_engines количество созданных
движков
шт.
available_engines количество доступных
движков
шт.
total_engines количество движков шт.
acquired_engines количество используемых
движков
шт.
overhead количество запросов
превышающее доступное
количество движков
шт.
wait_time время ожидания
доступного движка
мс
buffertransaction
dummytransaction
transaction_duration длительность транзакции мс
transactions_count количество транзакций шт.
request_size размер запроса
(количество символов)
шт.
processing_duration длительность обработки
транзакции
мс
processing_rtl соотношение размера
запроса к длительности
обработки
вещественное
число
128 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
processing_rtf соотношение
длительности обработки к
размеру запроса
вещественное
число
voicegrid processor
voicegridenginespool engines_count количество движков шт.
free_engines_count количество доступных
движков
шт.
engines_overhead количество запросов
превышающее доступное
количество движков
шт.
transactionscache transactions_count количество транзакций шт.
first_model_delay средняя задержка перед
первым построением
модели
мс
first_model_sound_len
gth
средний размер звука
перед первым
построением модели
байт
first_model_speech_le
ngth
средняя длительность
чистой речи перед
первым построением
модели
мс
handlestorage loaded_models_count количество загруженных
моделей
шт.
transactionsoundreceiver total_sound_received количество полученного
звука
байт
preprocessor preprocessor_active_q
ueue_length
размер active очереди
препроцессора
шт.
preprocessor_busy_qu
eue_length
размер busy очереди
препроцессора
шт.
preprocessor_avg_que
ue_time
среднее время
нахождения в очереди
preprocessor
мс
modelbuilder model_builder_active_
queue_length
размер active очереди
построителя моделей
шт.
model_builder_busy_q
ueue_length
размер busy очереди
построителя моделей
шт.
model_builder_avg_qu
eue_time
среднее время
нахождения в очереди
мс
129 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
model_builder
6.17.1 получение данных
получение данных
для доступа к данным, собираемым monitoring component, можно отправить поддерживаемый
компонентом http-запрос:
get /monitoring/rest/metrics
возвращает данные о всех компонентах voicekey.platform, зарегистрированных в менеджере
мониторинга.
возвращает массив, содержащий для каждого компонента информацию (name, confversion,
instanceid, ipaddress), статус компонента ("жив", "мёртв") и массив метрик (имя, начальное значение,
текущее значение), статистик (min, max, avg, total, count).
пример тела ответа для одного компонента:
[
{
"id": {
"conf_version": 446,
"component": "mrcpapplication",
"instance": "027aff60-39f0-41e1-8adb-fb9d27785e2e",
"ip": "172.25.0.38"
},
"metrics": [
{
"name": "integrity_verifier_count",
"initialvalue": 0,
"value": 0,
"statistics": [],
"lastupdatedatetime": "2020-10-08t10:42:33.982"
},
{
"name": "max_non_heap_memory",
"initialvalue": 0,
"value": 0,
"statistics": [],
"lastupdatedatetime": "2020-10-08t10:49:34.595"
},
{
"name": "initial_non_heap_memory",
"initialvalue": 0,
"value": 2.44,
"statistics": [],
"lastupdatedatetime": "2020-10-08t10:49:34.595"
},
{
"name": "component_state",
"initialvalue": 1,
"value": 1,
"statistics": [],
"lastupdatedatetime": "null"
},
130 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
{
"name": "max_heap_memory",
"initialvalue": 0,
"value": 910.5,
"statistics": [],
"lastupdatedatetime": "2020-10-08t10:49:34.595"
},
{
"name": "thread_count",
"initialvalue": 0,
"value": 100,
"statistics": [],
"lastupdatedatetime": "2020-10-08t10:49:34.595"
},
{
"name": "used_non_heap_memory",
"initialvalue": 0,
"value": 56.96,
"statistics": [],
"lastupdatedatetime": "2020-10-08t10:49:34.595"
},
{
"name": "initial_heap_memory",
"initialvalue": 0,
"value": 256,
"statistics": [],
"lastupdatedatetime": "2020-10-08t10:49:34.595"
},
{
"name": "peak_thread_count",
"initialvalue": 0,
"value": 100,
"statistics": [],
"lastupdatedatetime": "2020-10-08t10:49:34.595"
},
{
"name": "used_heap_memory",
"initialvalue": 0,
"value": 124.2,
"statistics": [],
"lastupdatedatetime": "2020-10-08t10:49:34.595"
}
],
"keepalivetime": "2020-10-08t10:49:17.503",
"state": "up"
},
...
...
...
]
get /monitoring/rest/metrics/prometheus
возвращает данные о текущих значениях метрик по всем компонентам платформы в формате,
подходящем для prometheus. тип данных: plain text.
пример тела ответа для одного компонента:
vkmon_integrity_verifier_count{component="mrcpapplication",instance="027aff60-39f0-41e1-8adb-fb9d27785e2e",ip="172.25.0.38"} vkmon_max_non_heap_memory{component="mrcpapplication",instance="027aff60-39f0-41e1-8adb-fb9d27785e2e",ip="172.25.0.38"} vkmon_initial_non_heap_memory{component="mrcpapplication",instance="027aff60-39f0-41e1-8adb-fb9d27785e2e",ip="172.25.0.38"} vkmon_component_state{component="mrcpapplication",instance="027aff60-39f0-41e1-8adb-fb9d27785e2e",ip="172.25.0.38"} vkmon_max_heap_memory{component="mrcpapplication",instance="027aff60-39f0-41e1-8adb-fb9d27785e2e",ip="172.25.0.38"} vkmon_thread_count{component="mrcpapplication",instance="027aff60-39f0-41e1-8adb-fb9d27785e2e",ip="172.25.0.38"} vkmon_used_non_heap_memory{component="mrcpapplication",instance="027aff60-39f0-41e1-8adb-fb9d27785e2e",ip="172.25.0.38"} vkmon_initial_heap_memory{component="mrcpapplication",instance="027aff60-39f0-41e1-8adb-fb9d27785e2e",ip="172.25.0.38"} vkmon_peak_thread_count{component="mrcpapplication",instance="027aff60-39f0-41e1-8adb-fb9d27785e2e",ip="172.25.0.38"} vkmon_used_heap_memory{component="mrcpapplication",instance="027aff60-39f0-41e1-8adb-fb9d27785e2e",ip="172.25.0.38"}
131 руководство по установке и настройке
установка и настройка компонентов voicekey.platform
визуализация данных
с помощью сторонних приложений prometheus и grafana можно визуализировать данные,
собранные monitoring component.
для выборки и агрегирования данных в prometheus используется язык запросов promql. чтобы
получить данные по всем метрикам компонента, необходимо в поле query ввести имя компонента
(например: tts_stc), для выборки конкретной метрики по компоненту запрос должен выглядеть
следующим образом: имя_компонента{metrics="имя метрики"} (например:
tts_stc{metrics="used_heap_memory"}). также возможны критерии выборки по instance и ip.
132 руководство по установке и настройке
управление компонентами voicekey.platform
7. управление компонентами
configurator component поддерживает удалённое управление компонентами. можно остановить,
запустить и перезапустить конкретный компонент на конкретном хосте.
для этого необходимо правильно настроить компонент и tomcat.
7.1 настройка конфигурационных файлов
для управления компонентами необходимо настроить 2 json-файлов конфигурации:
– host_management.json;
– component_management.json.
пути до файлов конфигурации необходимо указать при запуске компонента через параметры для
java:
-dhostmanagement.configurationfile="path/to/host_management.json" -
dcomponentmanagement.configurationfile="path/to/component_management.json"
файл host_management.json используется для настройки доступа к известным серверам. содержит
следующую структуру:
{
"hosts": [
{
"dns_name": "localhost",
"port": 22,
"username": "test_user",
"password": "woul+g1a0ekpiyi//dkmkq=="
},
...
{
"ipv4": "127.0.0.1",
"port": 22,
"username": "test_user",
"ssh_cert": "./src/test/resources/ssh.key",
"ssh_passphrase": "woul+g1a0ekpiyi//dkmkq=="
}
]
}
где:
hosts: массив, который содержит все известные сервера кластера с настройками для доступа к
каждому серверу по ssh;
dns_name*: доменное имя сервера;
ipv4*: ip-адрес сервера;
port*: ssh-порт сервера;
username*: логин для ssh доступа;
password*: пароль для ssh доступа в зашифрованном виде (шифратор паролей
(passwordcryptographer) выдаётся по запросу инженеру, осуществляющему настройку configurator
component);
ssh_cert*: путь до ssh закрытого ключа, который может использоваться для ssh доступа на сервер;
ssh_passphrase: пароль для доступа к ssh_cert сертификату (не обязательно, если не установлен
ssh_cert или не требуется пароль для доступа к сертификату ssh_cert).
обязательные параметры отмечены .
133 руководство по установке и настройке
управление компонентами voicekey.platform
файл component_management.json используется для настройки команд управления компонентами.
{
"components": [
{
"component_name" : "cache",
"stop_command": "systemctl stop vk_cachecomponent",
"start_command": "systemctl start vk_cachecomponent",
"restart_command": "systemctl restart vk_cachecomponent"
},
...
{
"component_name" : "chronicler",
"stop_command": "systemctl stop vk_chroniclercomponent",
"start_command": "systemctl start vk_chroniclercomponent",
"restart_command": "systemctl restart vk_chroniclercomponent"
},
{
"component_name": "voicekey.onepass",
"stop_command": "curl -u tomcat:${password} http://localhost:8080/manager/text/stop?
path=/vkonepass",
"start_command": "curl -u tomcat:${password} http://localhost:8080/manager/text/start?
path=/vkonepass",
"restart_command": "curl -u tomcat:${password} http://localhost:8080/manager/text/reload?
path=/vkonepass",
"password": "woul+g1a0ekpiyi//dkmkq=="
},
{
"component_name": "voicekey.agent",
"stop_command": "curl -u tomcat:${password} http://${host}:8080/manager/text/stop?
path=/${context_root}",
"start_command": "curl -u tomcat:${password} http://${host}:8080/manager/text/start?
path=/${context_root}",
"restart_command": "curl -u tomcat:${password} http://${host}:8080/manager/text/reload?
path=/${context_root}",
"password": "woul+g1a0ekpiyi//dkmkq=="
},
{
"component_name": "voicekey.api",
"stop_command": "echo stop.voicekey.api",
"start_command": "echo start.voicekey.api",
"restart_command": "echo restart.voicekey.api",
"host": "local"
}
]
}
где:
components: массив, содержащий компоненты с описанием команд для каждого компонента;
component_name: название компонента, соответствует названию компонента в конфигураторе;
stop_command: команда, которая выполнится на удалённом сервере для остановки компонента;
start_command: команда, которая выполнится на удалённом сервере для запуска компонента;
restart_command: команда, которая выполнится на удалённом сервере для перезапуска
компонента;
password: зашифрованный пароль, который можно использовать в команде. пароль будет
расшифрован и подставлен вместо переменной ${password}(шифратор паролей
(passwordcryptographer) выдаётся по запросу инженеру, осуществляющему настройку configurator
component);
${host}: если используется данная переменная, то при формировании команды вместо данной
переменной будет подставлен hostname, который передаётся с веб-интерфейса (имя сервера на котором
запущен компонент или приложение, и с которого он зарегистрировался в системе);
134 руководство по установке и настройке
управление компонентами voicekey.platform
${context_root}: если у перезагружаемого компонента есть context_root, то вместо данной
переменной будет подставлено значение context_root;
host: параметр, который можно использовать для переопределения хоста, на который будет
установлено подключение, чтобы выполнить команду компонента. в обычном случае подключение по ssh
устанавливается с хостом, с которого компонент зарегистрировался. но если настроен параметр host, то
ssh-соединение будет установлено с хостом, прописанным в host. если в поле установлено значение
local то команда будет выполнена на локальной машине, где запущен configurator component.
7.2 настройка tomcat
по умолчанию установка tomcat включает экземпляр приложения manager.
в файле tomcat-users.xml добавьте пользователя с паролем:
<tomcat-users>
...
<user username="tomcat" password="123456" roles="manager-script"/>
</tomcat-users>
более подробную информацию см. https://tomcat.apache.org/tomcat-7.0-doc/manager-howto.html.
135 руководство по установке и настройке
обновление компонентов voicekey.platform
8. обновление компонентов
8.1 обновление rpm
для обновления компонентов voicekey.platform необходимо выполнить следующие действия:
1. разместите необходимые пакеты с новой версией компонентов на обновляемом сервере.
2. остановите все установленные компоненты командой systemctl stop <component name>.
пример:
systemctl stop vk_configuratorcomponent
для остановки всех компонентов возможно использовать скрипт.
например, скрипт vkcomponents.sh:
#!/bin/sh
for n in $(ls /opt/ | grep vk); do systemctl $1 $n ; done
после создания скрипта необходимо сделать его исполняемым:
chmod +x vkcomponents.sh
для остановки всех компонентов выполните команду:
sh vkcomponents.sh stop
3. удалите все установленные компоненты командой rpm -e <component name>.
пример:
rpm -e vk_configuratorcomponent
или выполните скрипт, который удалит все компоненты:
for i in $(rpm -qa | grep vk); do rpm -e $i; done
4. выполните установку новых компонентов из пакетов командой rpm -uvh <component name>.
пример:
rpm -uvh vk_configuratorcomponent-1.0.0.228.rpm
8.2 обновление из yum-репозитория
при наличии репозитория для обновления компонентов выполните следующие действия:
1. поместите новые версии компонентов на сервер с репозиторием и запустите утилиту создания
репозитория createrepo для обновления каталога:
createrepo /var/www/html/vkplatform
2. установите компоненты, выполнив следующие команды на серверах с соответствующими
компонентами.
пример:
yum clean all
yum install vk_configuratorcomponent
136 руководство по установке и настройке
обновление компонентов voicekey.platform
8.3 настройка конфигурационных файлов
после обновления для каждого компонента создастся новый конфигурационный файл. старая версия
конфигурационного файла будет находиться в том же каталоге с расширением *.rpmsave.
для возможности использования настроек, выполненных ранее через веб-интерфейс конфигуратора,
необходимо произвести повторную настройку всей платформы через веб-интерфейс (см. раздел
настройка через configurator component), руководствуясь старым конфигурационным файлом
application.json.rpmsave.
8.4 обновление базы данных
обновление oracle
для обновления базы данных необходимо выполнить следующие действия.
1. войдите в систему от имени пользователя oracle с помощью команды:
su - oracle
2. запустите sqlplus от имени clientgeneral.
пример:
sqlplus clientgeneral/orcl
3. выполните скрипты первоначальной установки базы данных, которые поставляются в комплекте с
дистрибутивом, в порядке возрастания номера в начале названия файла.
пример:
sql> @/home/120-oracle-updatev2-configurations-added.sql
обновление postgres
для обновления базы данных необходимо выполнить следующие действия.
1. войдите в систему от имени пользователя postgres с помощью команды:
su - postgres
2. от имени пользователя clientgeneral выполните скрипты первоначальной установки базы
данных, которые поставляются в комплекте с дистрибутивом, в порядке возрастания номера в
начале названия файла.
пример:
psql -d vkplatform -u clientgeneral -a -f /path/to/scripts/120-postgres-updates.sql
137 руководство по установке и настройке
глоссарий voicekey.platform
9. глоссарий
биометрический
контрольный шаблон,
контрольный шаблон
биометрический шаблон персоны, хранящийся в базе данных комплекса
voicekey.platform. используется в качестве объекта биометрического
сравнения.
биометрический шаблон,
шаблон
совокупность биометрических описателей человека (голос, лицо,
отпечатки пальцев, сетчатка глаза и т.д.).
должность совокупность ролей, определяющих обязанности и полномочия
пользователя в пределах автоматизируемой процедуры.
одной должности могут быть назначены несколько ролей.
один пользователь может быть назначен на несколько должностей.
домен часть базы данных для хранения шаблонов, доступных определённым
группам пользователей.
компонент часть программного решения, реализующего определённую функцию.
общее определение для программного продукта в составе
voicekey.platform, независимо от типа: веб-сервис, веб-интерфейс,
сервис или обработчик.
метка метка доступа к ресурсу. присваивается ресурсу, а затем роли, для которой
этот ресурс необходим.
персона контейнер шаблонов определённого человека.
привилегия действие в системе, доступное пользователю.
программное решение
(решение)
совокупность программного обеспечения, необходимого для реализации
различных сценариев. включает в себя один или несколько компонентов и
voicekey.platform, необходимые для их функционирования.
ресурс запись в произвольной таблице, находящейся в бд.
роль совокупность привилегий и меток, над которыми пользователь в
определённой должности может совершать действия.
сессия верификации набор операций и данных, необходимых для выполнения одной процедуры
верификации клиента.
текстозависимая
верификация
проверка личности клиента по статической или динамической парольной
фразе.
текстонезависимая
верификация
проверка личности клиента по свободной речи, независимо от
произносимых фраз.
шина данных связующее по (middleware), обеспечивающее взаимодействие между
компонентами комплекса voicekey.platform на транспортном уровне.
экземпляр компонента конкретный компонент, запущенный на машине. допускается запуск только
одного компонента определённого типа, запущенного на машине.
fa (false acceptance) вероятность ошибочного ложного пропуска, когда один человек может
138 руководство по установке и настройке
глоссарий voicekey.platform
быть принят за другого (вероятность ошибки ложного пропуска (ii рода)).
fr (false rej ection) вероятность ошибочного отказа, когда человек может быть не распознан
системой (вероятность ошибки ложного отклонения (i рода)).